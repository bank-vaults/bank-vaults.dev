<!doctype html><html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name="generator" content="Hugo 0.110.0">
<link rel="alternate" type="text/releases" href="https://bank-vaults.dev/docs/hsm/nitrokey-opensc/releases.releases">
<meta name="robots" content="index, follow">
<link rel="shortcut icon" href="/favicons/favicon.ico">
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">
<title>NitroKey HSM support (OpenSC) | Bank-Vaults</title><meta name="description" content="Nitrokey HSM is a USB HSM device based on the OpenSC project. We are using NitroKey to develop real hardware-based HSM support for Bank-Vaults. This device is not a cryptographic accelerator, only key generation and the private key operations (sign and decrypt) are supported. Public key operations should be done by extracting the public key and working on the computer, and this is how it is implemented in Bank-Vaults. It is not possible to extract private keys from NitroKey HSM, the device is tamper-resistant.">
<meta property="og:title" content="NitroKey HSM support (OpenSC)">
<meta property="og:description" content="Nitrokey HSM is a USB HSM device based on the OpenSC project. We are using NitroKey to develop real hardware-based HSM support for Bank-Vaults. This device is not a cryptographic accelerator, only key generation and the private key operations (sign and decrypt) are supported. Public key operations should be done by extracting the public key and working on the computer, and this is how it is implemented in Bank-Vaults. It is not possible to extract private keys from NitroKey HSM, the device is tamper-resistant.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://bank-vaults.dev/docs/hsm/nitrokey-opensc/"><meta property="article:section" content="docs">
<meta property="article:modified_time" content="2023-07-25T16:39:54+02:00"><meta property="og:site_name" content="Bank-Vaults">
<meta itemprop="name" content="NitroKey HSM support (OpenSC)">
<meta itemprop="description" content="Nitrokey HSM is a USB HSM device based on the OpenSC project. We are using NitroKey to develop real hardware-based HSM support for Bank-Vaults. This device is not a cryptographic accelerator, only key generation and the private key operations (sign and decrypt) are supported. Public key operations should be done by extracting the public key and working on the computer, and this is how it is implemented in Bank-Vaults. It is not possible to extract private keys from NitroKey HSM, the device is tamper-resistant.">
<meta itemprop="dateModified" content="2023-07-25T16:39:54+02:00">
<meta itemprop="wordCount" content="1345">
<meta itemprop="keywords" content><meta name="twitter:card" content="summary">
<meta name="twitter:title" content="NitroKey HSM support (OpenSC)">
<meta name="twitter:description" content="Nitrokey HSM is a USB HSM device based on the OpenSC project. We are using NitroKey to develop real hardware-based HSM support for Bank-Vaults. This device is not a cryptographic accelerator, only key generation and the private key operations (sign and decrypt) are supported. Public key operations should be done by extracting the public key and working on the computer, and this is how it is implemented in Bank-Vaults. It is not possible to extract private keys from NitroKey HSM, the device is tamper-resistant.">
<meta name="twitter:site" content="@calisti12">
<link rel="preload" href="/scss/main.min.676617caf057b12362ecf7673d65047c5fe898a6461e02d928249cbc94b1bdab.css" as="style">
<link href="/scss/main.min.676617caf057b12362ecf7673d65047c5fe898a6461e02d928249cbc94b1bdab.css" rel="stylesheet" integrity>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK" crossorigin="anonymous"></script>
<script defer src="https://unpkg.com/lunr@2.3.9/lunr.min.js" integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli" crossorigin="anonymous"></script>
<link rel="stylesheet" href="/css/prism.css">
<script src="/js/w3.js" type="application/x-javascript"></script>
</head><body class="td-page">
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
<a class="navbar-brand" href="/"><span class="navbar-brand__logo navbar-logo"><svg width="144.26347" height="144.26346" viewBox="0 0 144.26348 144.26346" id="svg70" sodipodi:docname="logo.svg" inkscape:version="1.2.1 (9c6d41e4, 2022-07-14)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/"><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="1309" inkscape:window-height="456" id="namedview72" showgrid="false" inkscape:zoom="1.4142136" inkscape:cx="252.79067" inkscape:cy="89.095452" inkscape:window-x="0" inkscape:window-y="25" inkscape:window-maximized="0" inkscape:current-layer="g89" showguides="true" inkscape:guide-bbox="true" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:showpageshadow="0" inkscape:pagecheckerboard="1" inkscape:deskcolor="#d1d1d1"/><defs id="defs4"><style id="style2">.cls-1{fill:#36a8e1}</style><linearGradient gradientTransform="matrix(1,0,0,-1,539,276.5)" y2="276.63062" x2="-493.32941" y1="231.5972" x1="-498.4776" gradientUnits="userSpaceOnUse" id="SVGID_1_"><stop id="stop1134" style="stop-color:#3C8ECD" offset=".4032"/><stop id="stop1136" style="stop-color:#82CEF2" offset=".9943"/></linearGradient><linearGradient gradientTransform="matrix(1,0,0,-1,539,276.5)" y2="271.8768" x2="-515.39728" y1="233.5062" x1="-511.01059" gradientUnits="userSpaceOnUse" id="SVGID_2_"><stop id="stop1141" style="stop-color:#C18DBE" offset=".4032"/><stop id="stop1143" style="stop-color:#9DB4DD" offset="1"/></linearGradient><linearGradient gradientTransform="matrix(1,0,0,-1,539,276.5)" y2="282.21011" x2="-499.84381" y1="229.3567" x1="-493.8013" gradientUnits="userSpaceOnUse" id="SVGID_3_"><stop id="stop1148" style="stop-color:#454494" offset=".4032"/><stop id="stop1150" style="stop-color:#76A1D6" offset="1"/></linearGradient><linearGradient gradientTransform="matrix(1,0,0,-1,539,276.5)" y2="267.82639" x2="-470.24661" y1="235.1331" x1="-473.98431" gradientUnits="userSpaceOnUse" id="SVGID_4_"><stop id="stop1155" style="stop-color:#56BDC1" offset=".4032"/><stop id="stop1157" style="stop-color:#82CEF2" offset=".9943"/></linearGradient><linearGradient gradientTransform="matrix(1,0,0,-1,539,276.5)" y2="260.12711" x2="-494.45529" y1="229.73219" x1="-492.93121" gradientUnits="userSpaceOnUse" id="SVGID_5_"><stop id="stop1162" style="stop-color:#13287A" offset=".0057"/><stop id="stop1164" style="stop-color:#1A3D8E" offset="1"/></linearGradient><linearGradient gradientTransform="matrix(1,0,0,-1,539,276.5)" y2="235.2251" x2="-507.06671" y1="273.6745" x1="-512.83838" gradientUnits="userSpaceOnUse" id="SVGID_6_"><stop id="stop1169" style="stop-color:#466BB3" offset="0"/><stop id="stop1171" style="stop-color:#3C3079" offset=".7268"/></linearGradient><linearGradient gradientTransform="matrix(1,0,0,-1,539,276.5)" y2="266.69089" x2="-476.4068" y1="238.7536" x1="-482.8345" gradientUnits="userSpaceOnUse" id="SVGID_7_"><stop id="stop1176" style="stop-color:#1972A0" offset=".1924"/><stop id="stop1178" style="stop-color:#3B9FD9" offset="1"/></linearGradient></defs><g id="g2191-6" transform="matrix(1.0391419,0,0,1.0391419,-785.98152,-409.33734)"/><g id="g378" transform="matrix(0.21956619,0,0,0.21956619,-62.665715,99.533341)"><g id="g89" transform="matrix(0.96603773,0,0,0.96603773,0,19.798907)"><rect transform="matrix(4.5544353,0,0,4.5544353,0,-623.95763)" inkscape:export-ydpi="83.459999" inkscape:export-xdpi="83.459999" y="0" x="0" height="265" width="279.07285" id="rect1490-6" style="opacity:1;vector-effect:none;fill:none;fill-opacity:1;stroke:none;stroke-width:.540616;stroke-linecap:butt;stroke-linejoin:bevel;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;paint-order:stroke fill markers"/><g transform="matrix(2.2671253,0,0,2.2671253,-1470.9633,-791.56917)" id="g465-0"><path inkscape:connector-curvature="0" id="path218-5-3" d="m1079.1383 283.12854a150 150 0 01-150.00003 150 150 150 0 01-150-150 150 150 0 01150-150 150 150 0 01150.00003 150z" style="opacity:1;vector-effect:none;fill:#36a8e1;fill-opacity:1;stroke:none;stroke-width:1.59412;stroke-linecap:butt;stroke-linejoin:bevel;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;paint-order:stroke fill markers"/><g transform="matrix(2.0690654,0,0,2.0690654,739.12048,-2709.7574)" id="g1372-0-6"><path id="Path_1631-8-3-1" d="m140.98383 1464.3453c-.23051-1e-4-.46029-.026-.68499-.077l-25.05227-5.7194.12354-.2651c1.52748-3.2666 2.35115-6.818 2.41755-10.4236l.006-.2901 25.014 5.7107c.79405.1802 1.48298.6706 1.91325 1.362.43597.6876.57876 1.5212.39658 2.3148l-1.14156 5.0004c-.18024.794-.67067 1.483-1.36196 1.9133-.48769.3088-1.05281.4733-1.63004.4745z" class="cls-1" data-name="Path 1631" inkscape:connector-curvature="0" style="fill:#fff;stroke-width:.236204" sodipodi:nodetypes="ccccccccccccc"/><path id="Path_1632-4-6-0" d="m42.692762 1464.3453c-1.431928.0-2.67294-.9922-2.993412-2.3878l-1.141574-5.0004c-.182495-.7936-.03976-1.6272.396351-2.3149.43031-.6912 1.11923-1.1816 1.913251-1.3619l25.027696-5.7136.0056.2898c.06623 3.6055.889568 7.1567 2.416603 10.4235l.123771.265-25.064544 5.7224c-.224287.051-.453658.078-.683811.078z" class="cls-1" data-name="Path 1632" inkscape:connector-curvature="0" style="fill:#fff;stroke-width:.236204" sodipodi:nodetypes="cccccccccccc"/><path id="Path_1633-8-1-6" d="m86.203652 1421.9854v-25.527c.0018-1.6952 1.375526-3.0689 3.070652-3.0707h5.128931c1.695126.0 3.068839 1.3755 3.070651 3.0707v25.5244l-.284625-.06c-3.528917-.734-7.171122-.734-10.700038.0z" class="cls-1" data-name="Path 1633" inkscape:connector-curvature="0" style="fill:#fff;stroke-width:.236204" sodipodi:nodetypes="ccccccccc"/><path id="Path_1634-1-0-3" d="m68.4782 1436.0192-20.013323-15.9593c-.637548-.507-1.045807-1.2479-1.133778-2.0576-.09463-.8087.138439-1.6218.647198-2.2577l3.197729-4.0099c.506674-.6378 1.24758-1.0461 2.057336-1.1339.808868-.095 1.622095.138 2.257874.647l19.982853 15.9355-.222741.1854c-2.774754 2.3028-5.037618 5.1601-6.643471 8.3886z" class="cls-1" data-name="Path 1634" inkscape:connector-curvature="0" style="fill:#fff;stroke-width:.236204" sodipodi:nodetypes="ccccccccccc"/><path id="Path_1635-0-6-20" d="m111.69006 1497.5553c-1.18101 8e-4-2.25818-.6747-2.77162-1.7383l-11.17906-23.2188.283444-.069c3.503736-.8523 6.788826-2.4326 9.641606-4.6381l.23078-.1776 11.1774 23.2146c.35415.7333.40034 1.5777.12826 2.3453-.26575.7699-.8286 1.4012-1.56296 1.7533l-4.6211 2.2253c-.41379.1996-.8673.3034-1.32675.3035z" class="cls-1" data-name="Path 1635" inkscape:connector-curvature="0" style="fill:#fff;stroke-width:.236204" sodipodi:nodetypes="cccccccccccc"/><path id="Path_1636-3-3-61" d="m71.986066 1497.5553c-.459533.0-.913133-.1036-1.326994-.3035l-4.621331-2.2253c-.734212-.3523-1.297005-.9837-1.56296-1.7533-.272113-.7676-.225844-1.612.128494-2.3453l11.180949-23.2221.230772.1778c2.851924 2.2071 6.136543 3.7892 9.64019 4.6431l.283445.069-11.180476 23.2209c-.513556 1.0637-1.590928 1.7393-2.772089 1.7383z" class="cls-1" data-name="Path 1636" inkscape:connector-curvature="0" style="fill:#fff;stroke-width:.236204" sodipodi:nodetypes="cccccccccccc"/><path id="Path_1637-0-2-5" d="m115.20736 1436.0117-.13061-.2615c-1.60686-3.2281-3.87061-6.0848-6.64607-8.3867l-.22298-.1853 19.97672-15.9299c1.32641-1.0555 3.25699-.8379 4.3152.4864l3.19773 4.0099c1.05536 1.3265.8379 3.2569-.48611 4.3153z" class="cls-1" data-name="Path 1637" inkscape:connector-curvature="0" style="fill:#fff;stroke-width:.236204" sodipodi:nodetypes="ccccccccc"/></g><path sodipodi:nodetypes="ccccccccccccccccc" style="fill:#fff;stroke-width:.488708" inkscape:connector-curvature="0" data-name="Path 1611" class="cls-1" d="m953.64449 351.25645v0l-49.11506-.0269c-4.61319.0-8.97664-2.09451-11.8425-5.70793l-30.605-38.41323c-2.88324-3.59976-3.95895-8.32323-2.91945-12.81745l10.95094-47.87714c1.01715-4.50022 4.03882-8.28619 8.20095-10.27663l44.26-21.28965c4.15116-2.00969 8.99505-2.00969 13.14622.0l44.24138 21.33123c4.16027 1.9952 7.17883 5.77994 8.19205 10.28285l10.9077 47.88769c1.03498 4.49504-.0455 9.2183-2.93249 12.81517l-30.64182 38.38551c-2.8669 3.60969-7.22725 5.70937-11.83609 5.69717z" id="path1253-3-0-5"/><path sodipodi:nodetypes="ccccccccccccccccc" style="fill:#36a8e1;fill-opacity:1;stroke-width:.37402" inkscape:connector-curvature="0" data-name="Path 1611" class="cls-1" d="m947.8838 335.07491v0l-37.58892-.0228c-3.53065.0-6.86992-1.60353-9.06334-4.36945L877.8089 301.28397c-2.20666-2.75352-3.02994-6.36941-2.23439-9.80903l8.38096-36.64087c.77838-3.44417 3.09098-6.34189 6.27651-7.86493l33.8735-16.29513c3.17684-1.53773 6.88419-1.53773 10.06103.0l33.85902 16.32575c3.18408 1.52676 5.49399 4.42366 6.26968 7.86969l8.34785 36.64936c.79204 3.43961-.0331 7.0553-2.24431 9.80881l-23.451 29.37577c-2.19404 2.76323-5.53102 4.37048-9.05837 4.36117z" id="path1253-6-4"/><g transform="matrix(0.48872138,0,0,0.48872138,1906.5441,113.88789)" id="Group_365-8-1-7" data-name="Group 365" style="fill:#fff"><path sodipodi:nodetypes="cccccc" id="Path_1612-1-5-6" d="m-2036.06 314.053h-.06c-7.1763-.008-12.9917-5.82372-13-13-.018-7.19712 5.8029-13.04555 13-13.061 7.1967-.0177 13.0446 5.80326 13.06 13 .018 7.19712-5.8029 13.04555-13 13.061z" class="cls-1" data-name="Path 1612" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccccc" id="Path_1613-2-5-5" d="m-1963.88 314.053h-.06c-7.1763-.008-12.9917-5.82372-13-13-.018-7.19712 5.8029-13.04555 13-13.061 7.197-.0183 13.0451 5.80303 13.06 13 .018 7.19712-5.8029 13.04555-13 13.061zm0-24.061c-6.0926-.0188 6.0933.0138.0.0z" class="cls-1" data-name="Path 1613" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1614-9-4-69" d="m-2036.06 350.143h-.06c-7.1763-.008-12.9917-5.82372-13-13-.018-7.19696 5.803-13.04511 13-13.06 7.1967-.0177 13.0446 5.80326 13.06 13 .018 7.19673-5.8033 13.04455-13 13.06z" class="cls-1" data-name="Path 1614" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1615-3-7-3" d="m-1963.88 350.143h-.06c-7.1763-.008-12.9917-5.82372-13-13-.018-7.19673 5.8033-13.04455 13-13.06 7.197-.0183 13.0451 5.80303 13.06 13 .018 7.19696-5.803 13.04511-13 13.06z" class="cls-1" data-name="Path 1615" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1616-9-6-7" d="m-2036.06 386.233h-.06c-7.1763-.008-12.9917-5.82372-13-13-.018-7.19696 5.803-13.04511 13-13.06 7.1967-.0177 13.0446 5.80326 13.06 13 .018 7.19673-5.8033 13.04455-13 13.06z" class="cls-1" data-name="Path 1616" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1617-0-5-4" d="m-1999.97 314.053h-.06c-7.1765-.008-12.9923-5.8235-13-13-.018-7.19712 5.8029-13.04555 13-13.061 7.197-.0183 13.0451 5.80303 13.06 13 .018 7.19712-5.8029 13.04555-13 13.061z" class="cls-1" data-name="Path 1617" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1618-8-6-5" d="m-1999.97 350.143h-.06c-7.1765-.008-12.9923-5.8235-13-13-.018-7.19696 5.803-13.04511 13-13.06 7.197-.0183 13.0451 5.80303 13.06 13 .018 7.19696-5.803 13.04511-13 13.06z" class="cls-1" data-name="Path 1618" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1619-8-9-2" d="m-1999.97 386.233h-.06c-7.1765-.008-12.9923-5.8235-13-13-.018-7.19696 5.803-13.04511 13-13.06 7.197-.0183 13.0451 5.80303 13.06 13 .018 7.19696-5.803 13.04511-13 13.06z" class="cls-1" data-name="Path 1619" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1620-5-3-5" d="m-1999.97 422.323h-.06c-7.1765-.008-12.9923-5.8235-13-13-.018-7.19696 5.803-13.04511 13-13.06 7.197-.0182 13.0451 5.80303 13.06 13 .018 7.19696-5.803 13.04511-13 13.06z" class="cls-1" data-name="Path 1620" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1621-0-7-4" d="m-1963.88 386.233h-.06c-7.1763-.008-12.9917-5.82372-13-13-.018-7.19673 5.8033-13.04455 13-13.06 7.197-.0183 13.0451 5.80303 13.06 13 .018 7.19696-5.803 13.04511-13 13.06z" class="cls-1" data-name="Path 1621" inkscape:connector-curvature="0" style="fill:#fff"/></g></g></g></g></svg></span><span class="navbar-brand__name">Bank-Vaults</span>
<span class="font-weight-bold navbar-logo navbar-version">1.19.0</span></a>
<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
<ul class="navbar-nav mt-2 mt-lg-0">
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link" href="https://github.com/banzaicloud/bank-vaults" target="_blank"><span>Project page</span></a>
</li><li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link" href="/docs/"><span>Documentation</span></a>
</li></ul></div><div class="navbar-nav d-none d-lg-block">
<div class="td-search td-search--offline">
<div class="td-search__icon"></div><input type="search" class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete="off" data-offline-search-index-json-src="/offline-search-index.38c7a8b02048636206bb76469273850a.json" data-offline-search-base-href="/" data-offline-search-max-results="10">
</div></div></nav></header><div class="container-fluid td-outer">
<div class="td-main">
<div class="row flex-xl-nowrap">
<aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
<div id="td-sidebar-menu" class="td-sidebar__inner">
<form class="td-sidebar__search d-flex align-items-center">
<div class="td-search td-search--offline">
<div class="td-search__icon"></div><input type="search" class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete="off" data-offline-search-index-json-src="/offline-search-index.38c7a8b02048636206bb76469273850a.json" data-offline-search-base-href="/" data-offline-search-max-results="10">
</div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-section-nav" aria-expanded="false" aria-label="Toggle section navigation">
</button>
</form><nav class="collapse td-sidebar-nav foldable-nav" id="td-section-nav">
<ul class="td-sidebar-nav__section pr-md-3 ul-0">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-docs-li">
<a href="/docs/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-docs"><span>Documentation</span></a>
<ul class="ul-1">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsinstalling-li">
<input type="checkbox" id="m-docsinstalling-check">
<label for="m-docsinstalling-check"><a href="/docs/installing/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsinstalling"><span>Getting started</span></a></label>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsinstallingcustom-namespace-li">
<input type="checkbox" id="m-docsinstallingcustom-namespace-check">
<label for="m-docsinstallingcustom-namespace-check"><a href="/docs/installing/custom-namespace/" title="Deploy vault into a custom namespace" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsinstallingcustom-namespace"><span>Custom namespace</span></a></label>
</li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsexternal-configuration-li">
<input type="checkbox" id="m-docsexternal-configuration-check">
<label for="m-docsexternal-configuration-check"><a href="/docs/external-configuration/" title="External configuration for Vault" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsexternal-configuration"><span>External Vault configuration</span></a></label>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsexternal-configurationpurge-unmanaged-configuration-li">
<input type="checkbox" id="m-docsexternal-configurationpurge-unmanaged-configuration-check">
<label for="m-docsexternal-configurationpurge-unmanaged-configuration-check"><a href="/docs/external-configuration/purge-unmanaged-configuration/" title="Fully or partially purging unmanaged configuration in Vault" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsexternal-configurationpurge-unmanaged-configuration"><span>Purge unmanaged configuration</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsexternal-configurationaudit-devices-li">
<input type="checkbox" id="m-docsexternal-configurationaudit-devices-check">
<label for="m-docsexternal-configurationaudit-devices-check"><a href="/docs/external-configuration/audit-devices/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsexternal-configurationaudit-devices"><span>Audit devices</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsexternal-configurationauthentication-li">
<input type="checkbox" id="m-docsexternal-configurationauthentication-check">
<label for="m-docsexternal-configurationauthentication-check"><a href="/docs/external-configuration/authentication/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsexternal-configurationauthentication"><span>Authentication</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsexternal-configurationplugins-li">
<input type="checkbox" id="m-docsexternal-configurationplugins-check">
<label for="m-docsexternal-configurationplugins-check"><a href="/docs/external-configuration/plugins/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsexternal-configurationplugins"><span>Plugins</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsexternal-configurationpolicies-li">
<input type="checkbox" id="m-docsexternal-configurationpolicies-check">
<label for="m-docsexternal-configurationpolicies-check"><a href="/docs/external-configuration/policies/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsexternal-configurationpolicies"><span>Policies</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsexternal-configurationsecrets-engines-li">
<input type="checkbox" id="m-docsexternal-configurationsecrets-engines-check">
<label for="m-docsexternal-configurationsecrets-engines-check"><a href="/docs/external-configuration/secrets-engines/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsexternal-configurationsecrets-engines"><span>Secrets engines</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsexternal-configurationstartup-secrets-li">
<input type="checkbox" id="m-docsexternal-configurationstartup-secrets-check">
<label for="m-docsexternal-configurationstartup-secrets-check"><a href="/docs/external-configuration/startup-secrets/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsexternal-configurationstartup-secrets"><span>Startup secrets</span></a></label>
</li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsenvironment-variables-li">
<input type="checkbox" id="m-docsenvironment-variables-check">
<label for="m-docsenvironment-variables-check"><a href="/docs/environment-variables/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsenvironment-variables"><span>Environment variables</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsoperator-li">
<input type="checkbox" id="m-docsoperator-check">
<label for="m-docsoperator-check"><a href="/docs/operator/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsoperator"><span>Operator</span></a></label>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsoperatorhowto-vault-e2e-li">
<input type="checkbox" id="m-docsoperatorhowto-vault-e2e-check">
<label for="m-docsoperatorhowto-vault-e2e-check"><a href="/docs/operator/howto-vault-e2e/" title="Running Vault with external end to end encryption" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsoperatorhowto-vault-e2e"><span>External encryption</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsoperatortemplating-configuration-li">
<input type="checkbox" id="m-docsoperatortemplating-configuration-check">
<label for="m-docsoperatortemplating-configuration-check"><a href="/docs/operator/templating-configuration/" title="Using templates for injecting dynamic configuration" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsoperatortemplating-configuration"><span>Templating configuration</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsoperatorupgrade-vault-li">
<input type="checkbox" id="m-docsoperatorupgrade-vault-check">
<label for="m-docsoperatorupgrade-vault-check"><a href="/docs/operator/upgrade-vault/" title="Upgrade Vault with the Bank-Vaults operator" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsoperatorupgrade-vault"><span>Upgrade Vault</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsoperatorcr_example_and_explanation-li">
<input type="checkbox" id="m-docsoperatorcr_example_and_explanation-check">
<label for="m-docsoperatorcr_example_and_explanation-check"><a href="/docs/operator/cr_example_and_explanation/" title="Operator Configuration for Functioning Webhook Secrets Mutation" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsoperatorcr_example_and_explanation"><span>Operator and mutating webhook</span></a></label>
</li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsmutating-webhook-li">
<input type="checkbox" id="m-docsmutating-webhook-check">
<label for="m-docsmutating-webhook-check"><a href="/docs/mutating-webhook/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsmutating-webhook"><span>Mutating Webhook</span></a></label>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmutating-webhookdeploy-li">
<input type="checkbox" id="m-docsmutating-webhookdeploy-check">
<label for="m-docsmutating-webhookdeploy-check"><a href="/docs/mutating-webhook/deploy/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsmutating-webhookdeploy"><span>Deploy the webhook</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmutating-webhookconfiguration-li">
<input type="checkbox" id="m-docsmutating-webhookconfiguration-check">
<label for="m-docsmutating-webhookconfiguration-check"><a href="/docs/mutating-webhook/configuration/" title="Configuration examples and scenarios" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsmutating-webhookconfiguration"><span>Configure the webhook</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmutating-webhookannotations-li">
<input type="checkbox" id="m-docsmutating-webhookannotations-check">
<label for="m-docsmutating-webhookannotations-check"><a href="/docs/mutating-webhook/annotations/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsmutating-webhookannotations"><span>Annotations</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmutating-webhookvault-agent-templating-li">
<input type="checkbox" id="m-docsmutating-webhookvault-agent-templating-check">
<label for="m-docsmutating-webhookvault-agent-templating-check"><a href="/docs/mutating-webhook/vault-agent-templating/" title="Using Vault Agent Templating in the mutating webhook" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsmutating-webhookvault-agent-templating"><span>Vault Agent Templating</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmutating-webhookconsul-template-li">
<input type="checkbox" id="m-docsmutating-webhookconsul-template-check">
<label for="m-docsmutating-webhookconsul-template-check"><a href="/docs/mutating-webhook/consul-template/" title="Using consul-template in the mutating webhook" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsmutating-webhookconsul-template"><span>Consul template</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmutating-webhooktransit-encryption-li">
<input type="checkbox" id="m-docsmutating-webhooktransit-encryption-check">
<label for="m-docsmutating-webhooktransit-encryption-check"><a href="/docs/mutating-webhook/transit-encryption/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsmutating-webhooktransit-encryption"><span>Transit Encryption</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmutating-webhookmonitoring-li">
<input type="checkbox" id="m-docsmutating-webhookmonitoring-check">
<label for="m-docsmutating-webhookmonitoring-check"><a href="/docs/mutating-webhook/monitoring/" title="Monitoring the Webhook with Grafana and Prometheus" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsmutating-webhookmonitoring"><span>Monitoring</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmutating-webhookhowto-ct-prom-li">
<input type="checkbox" id="m-docsmutating-webhookhowto-ct-prom-check">
<label for="m-docsmutating-webhookhowto-ct-prom-check"><a href="/docs/mutating-webhook/howto-ct-prom/" title="Injecting consul-template into the Prometheus operator for Vault metrics" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsmutating-webhookhowto-ct-prom"><span>Injecting secrets into Prometheus</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmutating-webhookwebhooks-comparision-li">
<input type="checkbox" id="m-docsmutating-webhookwebhooks-comparision-check">
<label for="m-docsmutating-webhookwebhooks-comparision-check"><a href="/docs/mutating-webhook/webhooks-comparision/" title="Comparison of Banzai Cloud and HashiCorp mutating webhook for Vault" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsmutating-webhookwebhooks-comparision"><span>Comparison</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmutating-webhookexternal-vault-li">
<input type="checkbox" id="m-docsmutating-webhookexternal-vault-check">
<label for="m-docsmutating-webhookexternal-vault-check"><a href="/docs/mutating-webhook/external-vault/" title="Running the webhook and Vault on different clusters" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsmutating-webhookexternal-vault"><span>External Vault</span></a></label>
</li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsunseal-keys-li">
<input type="checkbox" id="m-docsunseal-keys-check">
<label for="m-docsunseal-keys-check"><a href="/docs/unseal-keys/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsunseal-keys"><span>Unseal keys</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docstls-li">
<input type="checkbox" id="m-docstls-check">
<label for="m-docstls-check"><a href="/docs/tls/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docstls"><span>TLS</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docscloud-permissions-li">
<input type="checkbox" id="m-docscloud-permissions-check">
<label for="m-docscloud-permissions-check"><a href="/docs/cloud-permissions/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docscloud-permissions"><span>Cloud permissions</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsbackup-li">
<input type="checkbox" id="m-docsbackup-check">
<label for="m-docsbackup-check"><a href="/docs/backup/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsbackup"><span>Backing up Vault</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsistio-li">
<input type="checkbox" id="m-docsistio-check">
<label for="m-docsistio-check"><a href="/docs/istio/" title="Running the Bank-Vaults secret webhook alongside Istio" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsistio"><span>Istio and Bank-Vaults</span></a></label>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsistiovault-outside-the-mesh-li">
<input type="checkbox" id="m-docsistiovault-outside-the-mesh-check">
<label for="m-docsistiovault-outside-the-mesh-check"><a href="/docs/istio/vault-outside-the-mesh/" title="Scenario 1 - Vault runs outside, the application inside the mesh" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsistiovault-outside-the-mesh"><span>Vault outside the mesh</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsistiovault-inside-the-mesh-li">
<input type="checkbox" id="m-docsistiovault-inside-the-mesh-check">
<label for="m-docsistiovault-inside-the-mesh-check"><a href="/docs/istio/vault-inside-the-mesh/" title="Scenario 2 - Running Vault inside the mesh" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsistiovault-inside-the-mesh"><span>Vault inside the mesh</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsistiovault-and-app-inside-the-mesh-li">
<input type="checkbox" id="m-docsistiovault-and-app-inside-the-mesh-check">
<label for="m-docsistiovault-and-app-inside-the-mesh-check"><a href="/docs/istio/vault-and-app-inside-the-mesh/" title="Scenario 3 - Both Vault and the app are running inside the mesh" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsistiovault-and-app-inside-the-mesh"><span>Vault and app inside the mesh</span></a></label>
</li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-docshsm-li">
<input type="checkbox" id="m-docshsm-check" checked>
<label for="m-docshsm-check"><a href="/docs/hsm/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docshsm"><span>HSM Support</span></a></label>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id="m-docshsmnitrokey-opensc-li">
<input type="checkbox" id="m-docshsmnitrokey-opensc-check" checked>
<label for="m-docshsmnitrokey-opensc-check"><a href="/docs/hsm/nitrokey-opensc/" title="NitroKey HSM support (OpenSC)" class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id="m-docshsmnitrokey-opensc"><span class="td-sidebar-nav-active-item">Nitrokey</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docshsmsofthsm-li">
<input type="checkbox" id="m-docshsmsofthsm-check">
<label for="m-docshsmsofthsm-check"><a href="/docs/hsm/softhsm/" title="SoftHSM support for testing" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docshsmsofthsm"><span>SoftHSM</span></a></label>
</li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docscli-tool-li">
<input type="checkbox" id="m-docscli-tool-check">
<label for="m-docscli-tool-check"><a href="/docs/cli-tool/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docscli-tool"><span>The CLI tool</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsgo-library-li">
<input type="checkbox" id="m-docsgo-library-check">
<label for="m-docsgo-library-check"><a href="/docs/go-library/" title="The Go library" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsgo-library"><span>Go library</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmonitoring-li">
<input type="checkbox" id="m-docsmonitoring-check">
<label for="m-docsmonitoring-check"><a href="/docs/monitoring/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsmonitoring"><span>Monitoring</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsannotations-and-labels-li">
<input type="checkbox" id="m-docsannotations-and-labels-check">
<label for="m-docsannotations-and-labels-check"><a href="/docs/annotations-and-labels/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsannotations-and-labels"><span>Annotations and labels</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsexternal-secrets-li">
<input type="checkbox" id="m-docsexternal-secrets-check">
<label for="m-docsexternal-secrets-check"><a href="/docs/external-secrets/" title="Watching External Secrets" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsexternal-secrets"><span>External Secrets</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docstips-and-tricks-li">
<input type="checkbox" id="m-docstips-and-tricks-check">
<label for="m-docstips-and-tricks-check"><a href="/docs/tips-and-tricks/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docstips-and-tricks"><span>Tips and tricks</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docssupport-li">
<input type="checkbox" id="m-docssupport-check">
<label for="m-docssupport-check"><a href="/docs/support/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docssupport"><span>Support</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdevelopment-li">
<input type="checkbox" id="m-docsdevelopment-check">
<label for="m-docsdevelopment-check"><a href="/docs/development/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsdevelopment"><span>Development</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docscontributing-li">
<input type="checkbox" id="m-docscontributing-check">
<label for="m-docscontributing-check"><a href="/docs/contributing/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docscontributing"><span>Contributing</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmaintainer-li">
<input type="checkbox" id="m-docsmaintainer-check">
<label for="m-docsmaintainer-check"><a href="/docs/maintainer/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsmaintainer"><span>Maintainer guide</span></a></label>
</li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
<a href="https://github.com/bank-vaults/bank-vaults.dev/tree/main/content/docs/hsm/nitrokey-opensc.md" class="td-page-meta--view" target="_blank" rel="noopener"><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href="https://github.com/bank-vaults/bank-vaults.dev/edit/main/content/docs/hsm/nitrokey-opensc.md" class="td-page-meta--edit" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/bank-vaults/bank-vaults.dev/new/main/content/docs/hsm/nitrokey-opensc.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/bank-vaults/bank-vaults.dev/issues/new?title=NitroKey%20HSM%20support%20%28OpenSC%29" class="td-page-meta--issue" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
<a href="https://github.com/banzaicloud/bank-vaults/issues/new" class="td-page-meta--project-issue" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create project issue</a>
<a id="print" href="https://bank-vaults.dev/docs/hsm/_print/"><i class="fa-solid fa-print fa-fw"></i> Print entire section</a>
</div><div class="td-toc">
<nav id="TableOfContents">
<ul>
<li><a href="#nitrokey-minikube">Setup on Minikube for testing (optional)</a></li><li><a href="#node-setup">Kubernetes node setup</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
<nav aria-label="breadcrumb" class="td-breadcrumbs">
<ol class="breadcrumb">
<li class="breadcrumb-item">
<a href="https://bank-vaults.dev/docs/">Documentation</a>
</li><li class="breadcrumb-item">
<a href="https://bank-vaults.dev/docs/hsm/">HSM Support</a>
</li><li class="breadcrumb-item active" aria-current="page">
<a href="https://bank-vaults.dev/docs/hsm/nitrokey-opensc/" aria-disabled="true" class="btn-link disabled">Nitrokey</a>
</li></ol></nav><div class="td-content">
<h1>NitroKey HSM support (OpenSC)</h1><header class="article-meta">
</header><p><a href="https://www.nitrokey.com/">Nitrokey HSM</a> is a USB HSM device based on the <a href="https://github.com/OpenSC/OpenSC">OpenSC project</a>. We are using NitroKey to develop real hardware-based HSM support for Bank-Vaults. This device is not a cryptographic accelerator, only key generation and the private key operations (sign and decrypt) are supported. Public key operations should be done by extracting the public key and working on the computer, and this is how it is implemented in Bank-Vaults. It is not possible to extract private keys from NitroKey HSM, the device is tamper-resistant.</p><p>This device supports only RSA based encryption/decryption, and thus this is implemented in Bank-Vaults currently. It supports ECC keys as well, but only for sign/verification operations.</p><p>To start using a NitroKey HSM, complete the following steps.</p><ol>
<li>
<p>Install OpenSC and initialize the NitroKey HSM stick:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>brew install opensc
</span></span><span style="display:flex"><span>sc-hsm-tool --initialize --label bank-vaults --pin banzai --so-pin banzaicloud
</span></span><span style="display:flex"><span>pkcs11-tool --module /usr/local/lib/opensc-pkcs11.so --keypairgen --key-type rsa:2048 --pin banzai --token-label bank-vaults --label bank-vaults
</span></span></code></pre></div></li><li>
<p>Check that you got a keypair object in slot 0:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>pkcs11-tool --list-objects
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>Using slot <span style="color:#0000cf;font-weight:700">0</span> with a present token <span style="color:#ce5c00;font-weight:700">(</span>0x0<span style="color:#ce5c00;font-weight:700">)</span>
</span></span><span style="display:flex"><span>Public Key Object<span style="color:#000;font-weight:700">;</span> RSA <span style="color:#0000cf;font-weight:700">2048</span> bits
</span></span><span style="display:flex"><span>  label:      bank-vaults
</span></span><span style="display:flex"><span>  ID:         a9548075b20243627e971873826ead172e932359
</span></span><span style="display:flex"><span>  Usage:      encrypt, verify, wrap
</span></span><span style="display:flex"><span>  Access:     none
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>pkcs15-tool --list-keys
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>Using reader with a card: Nitrokey Nitrokey HSM
</span></span><span style="display:flex"><span>Private RSA Key <span style="color:#ce5c00;font-weight:700">[</span>bank-vaults<span style="color:#ce5c00;font-weight:700">]</span>
</span></span><span style="display:flex"><span>  Object Flags   : <span style="color:#ce5c00;font-weight:700">[</span>0x03<span style="color:#ce5c00;font-weight:700">]</span>, private, modifiable
</span></span><span style="display:flex"><span>  Usage          : <span style="color:#ce5c00;font-weight:700">[</span>0x0E<span style="color:#ce5c00;font-weight:700">]</span>, decrypt, sign, signRecover
</span></span><span style="display:flex"><span>  Access Flags   : <span style="color:#ce5c00;font-weight:700">[</span>0x1D<span style="color:#ce5c00;font-weight:700">]</span>, sensitive, alwaysSensitive, neverExtract, <span style="color:#204a87">local</span>
</span></span><span style="display:flex"><span>  ModLength      : <span style="color:#0000cf;font-weight:700">2048</span>
</span></span><span style="display:flex"><span>  Key ref        : <span style="color:#0000cf;font-weight:700">1</span> <span style="color:#ce5c00;font-weight:700">(</span>0x01<span style="color:#ce5c00;font-weight:700">)</span>
</span></span><span style="display:flex"><span>  Native         : yes
</span></span><span style="display:flex"><span>  Auth ID        : <span style="color:#0000cf;font-weight:700">01</span>
</span></span><span style="display:flex"><span>  ID             : a9548075b20243627e971873826ead172e932359
</span></span><span style="display:flex"><span>  MD:guid        : a6b2832c-1dc5-f4ef-bb0f-7b3504f67015
</span></span></code></pre></div></li><li>
<p>If you are testing the HSM on macOS, <a href="#nitrokey-minikube">setup minikube</a>. Otherwise, continue with the next step.</p></li><li>
<p>Configure the operator to use NitroKey HSM for unsealing.</p><p>You must adjust the <code>unsealConfig</code> section in the vault-operator configuration, so the operator can communicate with OpenSC HSM devices correctly. Adjust your configuration based on the following snippet:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># This example relies on an OpenSC HSM (NitroKey HSM) device initialized and plugged in to the Kubernetes Node.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">unsealConfig</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">hsm</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># OpenSC daemon is needed in this case to communicate with the device</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">daemon</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:700">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># The HSM SO module path (opensc is built into the bank-vaults image)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">modulePath</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/usr/lib/opensc-pkcs11.so</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># For OpenSC slotId is the preferred way instead of tokenLabel</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># (OpenSC appends/prepends some extra stuff to labels)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">slotId</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">pin</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">banzai</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># This can be specified in the BANK_VAULTS_HSM_PIN environment variable as well, from a Secret</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">keyLabel</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">bank-vaults</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li><li>
<p><a href="#node-setup">Configure your Kubernetes node</a> that has the HSM attached so Bank-Vaults can access it.</p></li></ol><h2 id="nitrokey-minikube">Setup on Minikube for testing (optional)</h2><p>On macOS where you run Docker in VMs you need to do some extra steps before mounting your HSM device to Kubernetes.
Complete the following steps to mount NitroKey into the <code>minikube</code> Kubernetes cluster:</p><ol>
<li>
<p>Make sure that the Oracle VM VirtualBox Extension Pack for USB 2.0 support is installed.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>VBoxManage list extpacks
</span></span></code></pre></div></li><li>
<p>Remove the HSM device from your computer if it is already plugged in.</p></li><li>
<p>Specify VirtualBox as the VM backend for Minikube.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>minikube config <span style="color:#204a87">set</span> vm-driver virtualbox
</span></span></code></pre></div></li><li>
<p>Create a minikube cluster with the virtualbox driver and stop it, so you can modify the VM.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>minikube start
</span></span><span style="display:flex"><span>minikube stop
</span></span></code></pre></div></li><li>
<p>Enable USB 2.0 support for the minikube VM.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>VBoxManage modifyvm minikube --usbehci on
</span></span></code></pre></div></li><li>
<p>Find the vendorid and productid for your Nitrokey HSM device.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>VBoxManage list usbhost
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#000">VENDORID</span><span style="color:#ce5c00;font-weight:700">=</span>0x20a0
</span></span><span style="display:flex"><span><span style="color:#000">PRODUCTID</span><span style="color:#ce5c00;font-weight:700">=</span>0x4230
</span></span></code></pre></div></li><li>
<p>Create a filter for it.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>VBoxManage usbfilter add <span style="color:#0000cf;font-weight:700">1</span> --target minikube --name <span style="color:#4e9a06">&#34;Nitrokey HSM&#34;</span> --vendorid <span style="color:#4e9a06">${</span><span style="color:#000">VENDORID</span><span style="color:#4e9a06">}</span> --productid <span style="color:#4e9a06">${</span><span style="color:#000">PRODUCTID</span><span style="color:#4e9a06">}</span>
</span></span></code></pre></div></li><li>
<p>Restart the minikube VM.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>minikube start
</span></span></code></pre></div></li><li>
<p>Plug in the USB device.</p></li><li>
<p>Check that minikube captured your NitorKey HSM.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>minikube ssh lsusb <span style="color:#000;font-weight:700">|</span> grep <span style="color:#4e9a06">${</span><span style="color:#000">VENDORID</span><span style="color:#000;font-weight:700">:</span><span style="color:#000">2</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">PRODUCTID</span><span style="color:#000;font-weight:700">:</span><span style="color:#000">2</span><span style="color:#4e9a06">}</span>
</span></span></code></pre></div></li></ol><p>Now your <code>minikube</code> Kubernetes cluster has access to the HSM device through USB.</p><h2 id="node-setup">Kubernetes node setup</h2><p>Some HSM vendors offer network daemons to enhance the reach of their HSM equipment to different servers. Unfortunately, there is no networking standard defined for PKCS11 access and thus currently Bank-Vaults has to be scheduled to the same node where the HSM device is attached directly (if not using a Cloud HSM).</p><p>Since the HSM is a hardware device connected to a physical node, Bank-Vaults has to find its way to that node. To make this work, create an HSM <a href="https://kubernetes.io/docs/tasks/administer-cluster/extended-resource-node/">extended resource</a> on the Kubernetes nodes for which the HSM device is plugged in. Extended resources must be advertised in integer amounts, for example, a Node can advertise four HSM devices, but not 4.5.</p><ol>
<li>
<p>You need to patch the node to specify that it has an HSM device as a resource.
Because of the integer constraint and because all Bank-Vaults related Pods has to land on a Node where an HSM resource is available we need to advertise two units for 1 device, one will be allocated by each Vault Pod and one by the Configurer. If you would like to run Vault in HA mode - multiple Vault instances in different nodes - you will need multiple HSM devices plugged into those nodes, having the same key and slot setup.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl proxy <span style="color:#000;font-weight:700">&amp;</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#000">NODE</span><span style="color:#ce5c00;font-weight:700">=</span>minikube
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>curl --header <span style="color:#4e9a06">&#34;Content-Type: application/json-patch+json&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06"></span>    --request PATCH <span style="color:#4e9a06">\
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06"></span>    --data <span style="color:#4e9a06">&#39;[{&#34;op&#34;: &#34;add&#34;, &#34;path&#34;: &#34;/status/capacity/nitrokey.com~1hsm&#34;, &#34;value&#34;: &#34;2&#34;}]&#39;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06"></span>    http://localhost:8001/api/v1/nodes/<span style="color:#4e9a06">${</span><span style="color:#000">NODE</span><span style="color:#4e9a06">}</span>/status
</span></span></code></pre></div><p>From now on, you can request the <code>nitrokey.com/hsm</code> resource <a href="https://kubernetes.io/docs/tasks/configure-pod-container/extended-resource/">in the PodSpec</a></p></li><li>
<p>Include the <code>nitrokey.com/hsm</code> resource in your PodSpec:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># If using the NitroKey HSM example, that resource has to be part of the resource scheduling request.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">resources</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">hsmDaemon</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">requests</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">cpu</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">100m</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">memory</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">64Mi</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">nitrokey.com/hsm</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">limits</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">cpu</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">200m</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">memory</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">128Mi</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">nitrokey.com/hsm</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li><li>
<p>Apply the modified setup from scratch:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl delete vault vault
</span></span><span style="display:flex"><span>kubectl delete pvc vault-file-vault-0
</span></span><span style="display:flex"><span>kubectl delete secret vault-unseal-keys
</span></span><span style="display:flex"><span>kubectl apply -f https://raw.githubusercontent.com/bank-vaults/vault-operator/main/deploy/examples/cr-hsm-nitrokey.yaml
</span></span></code></pre></div></li><li>
<p>Check the logs that unsealing uses the NitroKey HSM device. Run the following command:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl logs -f vault-0 bank-vaults
</span></span></code></pre></div><p>The output should be something like:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;2020-03-04T13:32:29Z&#34;</span> <span style="color:#000">level</span><span style="color:#ce5c00;font-weight:700">=</span>info <span style="color:#000">msg</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;HSM Information {CryptokiVersion:{Major:2 Minor:20} ManufacturerID:OpenSC Project Flags:0 LibraryDescription:OpenSC smartcard framework LibraryVersion:{Major:0 Minor:20}}&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;2020-03-04T13:32:29Z&#34;</span> <span style="color:#000">level</span><span style="color:#ce5c00;font-weight:700">=</span>info <span style="color:#000">msg</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;HSM Searching for slot in HSM slots [{ctx:0xc0000c0318 id:0}]&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;2020-03-04T13:32:29Z&#34;</span> <span style="color:#000">level</span><span style="color:#ce5c00;font-weight:700">=</span>info <span style="color:#000">msg</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;found HSM slot 0 in HSM by slot ID&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;2020-03-04T13:32:29Z&#34;</span> <span style="color:#000">level</span><span style="color:#ce5c00;font-weight:700">=</span>info <span style="color:#000">msg</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;HSM TokenInfo {Label:bank-vaults (UserPIN)\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00 ManufacturerID:www.CardContact.de Model:PKCS#15 emulated SerialNumber:DENK0200074 Flags:1037 MaxSessionCount:0 SessionCount:0 MaxRwSessionCount:0 RwSessionCount:0 MaxPinLen:15 MinPinLen:6 TotalPublicMemory:18446744073709551615 FreePublicMemory:18446744073709551615 TotalPrivateMemory:18446744073709551615 FreePrivateMemory:18446744073709551615 HardwareVersion:{Major:24 Minor:13} FirmwareVersion:{Major:3 Minor:3} UTCTime:\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00}&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;2020-03-04T13:32:29Z&#34;</span> <span style="color:#000">level</span><span style="color:#ce5c00;font-weight:700">=</span>info <span style="color:#000">msg</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;HSM SlotInfo for slot 0: {SlotDescription:Nitrokey Nitrokey HSM (DENK02000740000         ) 00 00 ManufacturerID:Nitrokey Flags:7 HardwareVersion:{Major:0 Minor:0} FirmwareVersion:{Major:0 Minor:0}}&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;2020-03-04T13:32:29Z&#34;</span> <span style="color:#000">level</span><span style="color:#ce5c00;font-weight:700">=</span>info <span style="color:#000">msg</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;found objects with label \&#34;bank-vaults\&#34; in HSM&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;2020-03-04T13:32:29Z&#34;</span> <span style="color:#000">level</span><span style="color:#ce5c00;font-weight:700">=</span>info <span style="color:#000">msg</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;this HSM device doesn&#39;t support encryption, extracting public key and doing encrytion on the computer&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;2020-03-04T13:32:29Z&#34;</span> <span style="color:#000">level</span><span style="color:#ce5c00;font-weight:700">=</span>info <span style="color:#000">msg</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;no storage backend specified for HSM, using on device storage&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;2020-03-04T13:32:29Z&#34;</span> <span style="color:#000">level</span><span style="color:#ce5c00;font-weight:700">=</span>info <span style="color:#000">msg</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;joining leader vault...&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;2020-03-04T13:32:29Z&#34;</span> <span style="color:#000">level</span><span style="color:#ce5c00;font-weight:700">=</span>info <span style="color:#000">msg</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;vault metrics exporter enabled: :9091/metrics&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">[</span>GIN-debug<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span>WARNING<span style="color:#ce5c00;font-weight:700">]</span> Running in <span style="color:#4e9a06">&#34;debug&#34;</span> mode. Switch to <span style="color:#4e9a06">&#34;release&#34;</span> mode in production.
</span></span><span style="display:flex"><span>- using env:	<span style="color:#204a87">export</span> <span style="color:#000">GIN_MODE</span><span style="color:#ce5c00;font-weight:700">=</span>release
</span></span><span style="display:flex"><span>- using code:	gin.SetMode<span style="color:#ce5c00;font-weight:700">(</span>gin.ReleaseMode<span style="color:#ce5c00;font-weight:700">)</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">[</span>GIN-debug<span style="color:#ce5c00;font-weight:700">]</span> GET    /metrics                  --&gt; github.com/gin-gonic/gin.WrapH.func1 <span style="color:#ce5c00;font-weight:700">(</span><span style="color:#0000cf;font-weight:700">3</span> handlers<span style="color:#ce5c00;font-weight:700">)</span>
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">[</span>GIN-debug<span style="color:#ce5c00;font-weight:700">]</span> Listening and serving HTTP on :9091
</span></span><span style="display:flex"><span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;2020-03-04T13:32:30Z&#34;</span> <span style="color:#000">level</span><span style="color:#ce5c00;font-weight:700">=</span>info <span style="color:#000">msg</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;initializing vault...&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;2020-03-04T13:32:30Z&#34;</span> <span style="color:#000">level</span><span style="color:#ce5c00;font-weight:700">=</span>info <span style="color:#000">msg</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;initializing vault&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;2020-03-04T13:32:31Z&#34;</span> <span style="color:#000">level</span><span style="color:#ce5c00;font-weight:700">=</span>info <span style="color:#000">msg</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;unseal key stored in key store&#34;</span> <span style="color:#000">key</span><span style="color:#ce5c00;font-weight:700">=</span>vault-unseal-0
</span></span><span style="display:flex"><span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;2020-03-04T13:32:31Z&#34;</span> <span style="color:#000">level</span><span style="color:#ce5c00;font-weight:700">=</span>info <span style="color:#000">msg</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;unseal key stored in key store&#34;</span> <span style="color:#000">key</span><span style="color:#ce5c00;font-weight:700">=</span>vault-unseal-1
</span></span><span style="display:flex"><span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;2020-03-04T13:32:32Z&#34;</span> <span style="color:#000">level</span><span style="color:#ce5c00;font-weight:700">=</span>info <span style="color:#000">msg</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;unseal key stored in key store&#34;</span> <span style="color:#000">key</span><span style="color:#ce5c00;font-weight:700">=</span>vault-unseal-2
</span></span><span style="display:flex"><span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;2020-03-04T13:32:32Z&#34;</span> <span style="color:#000">level</span><span style="color:#ce5c00;font-weight:700">=</span>info <span style="color:#000">msg</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;unseal key stored in key store&#34;</span> <span style="color:#000">key</span><span style="color:#ce5c00;font-weight:700">=</span>vault-unseal-3
</span></span><span style="display:flex"><span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;2020-03-04T13:32:33Z&#34;</span> <span style="color:#000">level</span><span style="color:#ce5c00;font-weight:700">=</span>info <span style="color:#000">msg</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;unseal key stored in key store&#34;</span> <span style="color:#000">key</span><span style="color:#ce5c00;font-weight:700">=</span>vault-unseal-4
</span></span><span style="display:flex"><span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;2020-03-04T13:32:33Z&#34;</span> <span style="color:#000">level</span><span style="color:#ce5c00;font-weight:700">=</span>info <span style="color:#000">msg</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;root token stored in key store&#34;</span> <span style="color:#000">key</span><span style="color:#ce5c00;font-weight:700">=</span>vault-root
</span></span><span style="display:flex"><span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;2020-03-04T13:32:33Z&#34;</span> <span style="color:#000">level</span><span style="color:#ce5c00;font-weight:700">=</span>info <span style="color:#000">msg</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;vault is sealed, unsealing&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;2020-03-04T13:32:39Z&#34;</span> <span style="color:#000">level</span><span style="color:#ce5c00;font-weight:700">=</span>info <span style="color:#000">msg</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;successfully unsealed vault&#34;</span>
</span></span></code></pre></div></li><li>
<p>Find the unseal keys and the root token on the HSM:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>pkcs11-tool --list-objects
</span></span></code></pre></div><p>Expected output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>Using slot <span style="color:#0000cf;font-weight:700">0</span> with a present token <span style="color:#ce5c00;font-weight:700">(</span>0x0<span style="color:#ce5c00;font-weight:700">)</span>
</span></span><span style="display:flex"><span>Public Key Object<span style="color:#000;font-weight:700">;</span> RSA <span style="color:#0000cf;font-weight:700">2048</span> bits
</span></span><span style="display:flex"><span>  label:      bank-vaults
</span></span><span style="display:flex"><span>  ID:         a9548075b20243627e971873826ead172e932359
</span></span><span style="display:flex"><span>  Usage:      encrypt, verify, wrap
</span></span><span style="display:flex"><span>  Access:     none
</span></span><span style="display:flex"><span>Data object <span style="color:#0000cf;font-weight:700">2168561792</span>
</span></span><span style="display:flex"><span>  label:          <span style="color:#4e9a06">&#39;vault-test&#39;</span>
</span></span><span style="display:flex"><span>  application:    <span style="color:#4e9a06">&#39;vault-test&#39;</span>
</span></span><span style="display:flex"><span>  app_id:         &lt;empty&gt;
</span></span><span style="display:flex"><span>  flags:           modifiable
</span></span><span style="display:flex"><span>Data object <span style="color:#0000cf;font-weight:700">2168561168</span>
</span></span><span style="display:flex"><span>  label:          <span style="color:#4e9a06">&#39;vault-unseal-0&#39;</span>
</span></span><span style="display:flex"><span>  application:    <span style="color:#4e9a06">&#39;vault-unseal-0&#39;</span>
</span></span><span style="display:flex"><span>  app_id:         &lt;empty&gt;
</span></span><span style="display:flex"><span>  flags:           modifiable
</span></span><span style="display:flex"><span>Data object <span style="color:#0000cf;font-weight:700">2168561264</span>
</span></span><span style="display:flex"><span>  label:          <span style="color:#4e9a06">&#39;vault-unseal-1&#39;</span>
</span></span><span style="display:flex"><span>  application:    <span style="color:#4e9a06">&#39;vault-unseal-1&#39;</span>
</span></span><span style="display:flex"><span>  app_id:         &lt;empty&gt;
</span></span><span style="display:flex"><span>  flags:           modifiable
</span></span><span style="display:flex"><span>Data object <span style="color:#0000cf;font-weight:700">2168561360</span>
</span></span><span style="display:flex"><span>  label:          <span style="color:#4e9a06">&#39;vault-unseal-2&#39;</span>
</span></span><span style="display:flex"><span>  application:    <span style="color:#4e9a06">&#39;vault-unseal-2&#39;</span>
</span></span><span style="display:flex"><span>  app_id:         &lt;empty&gt;
</span></span><span style="display:flex"><span>  flags:           modifiable
</span></span><span style="display:flex"><span>Data object <span style="color:#0000cf;font-weight:700">2168562304</span>
</span></span><span style="display:flex"><span>  label:          <span style="color:#4e9a06">&#39;vault-unseal-3&#39;</span>
</span></span><span style="display:flex"><span>  application:    <span style="color:#4e9a06">&#39;vault-unseal-3&#39;</span>
</span></span><span style="display:flex"><span>  app_id:         &lt;empty&gt;
</span></span><span style="display:flex"><span>  flags:           modifiable
</span></span><span style="display:flex"><span>Data object <span style="color:#0000cf;font-weight:700">2168562400</span>
</span></span><span style="display:flex"><span>  label:          <span style="color:#4e9a06">&#39;vault-unseal-4&#39;</span>
</span></span><span style="display:flex"><span>  application:    <span style="color:#4e9a06">&#39;vault-unseal-4&#39;</span>
</span></span><span style="display:flex"><span>  app_id:         &lt;empty&gt;
</span></span><span style="display:flex"><span>  flags:           modifiable
</span></span><span style="display:flex"><span>Data object <span style="color:#0000cf;font-weight:700">2168562496</span>
</span></span><span style="display:flex"><span>  label:          <span style="color:#4e9a06">&#39;vault-root&#39;</span>
</span></span><span style="display:flex"><span>  application:    <span style="color:#4e9a06">&#39;vault-root&#39;</span>
</span></span><span style="display:flex"><span>  app_id:         &lt;empty&gt;
</span></span><span style="display:flex"><span>  flags:           modifiable
</span></span></code></pre></div></li><li>
<p>If you don&rsquo;t need the encryption keys or the unseal keys on the HSM anymore, you can delete them with the following commands:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span><span style="color:#000">PIN</span><span style="color:#ce5c00;font-weight:700">=</span>banzai
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#8f5902;font-style:italic"># Delete the unseal keys and the root token</span>
</span></span><span style="display:flex"><span><span style="color:#204a87;font-weight:700">for</span> label in <span style="color:#4e9a06">&#34;vault-test&#34;</span> <span style="color:#4e9a06">&#34;vault-root&#34;</span> <span style="color:#4e9a06">&#34;vault-unseal-0&#34;</span> <span style="color:#4e9a06">&#34;vault-unseal-1&#34;</span> <span style="color:#4e9a06">&#34;vault-unseal-2&#34;</span> <span style="color:#4e9a06">&#34;vault-unseal-3&#34;</span> <span style="color:#4e9a06">&#34;vault-unseal-4&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#204a87;font-weight:700">do</span>
</span></span><span style="display:flex"><span>  pkcs11-tool --delete-object --type data --label <span style="color:#4e9a06">${</span><span style="color:#000">label</span><span style="color:#4e9a06">}</span> --pin <span style="color:#4e9a06">${</span><span style="color:#000">PIN</span><span style="color:#4e9a06">}</span>
</span></span><span style="display:flex"><span><span style="color:#204a87;font-weight:700">done</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#8f5902;font-style:italic"># Delete the encryption key</span>
</span></span><span style="display:flex"><span>pkcs11-tool --delete-object --type privkey --label bank-vaults --pin <span style="color:#4e9a06">${</span><span style="color:#000">PIN</span><span style="color:#4e9a06">}</span>
</span></span></code></pre></div></li></ol><div class="text-muted mt-5 pt-3 border-top">
Last modified July 25, 2023: <a href="https://github.com/bank-vaults/bank-vaults.dev/commit/1021aa4fefa0160382fc3ca12d6e6b686cfe77ff">Merge 9a3982484d044b0d3de8f8eb531008482fea164a into 54c25690a306e341082608f7e7196546cc89a06e (1021aa4)</a>
</div></div></main></div></div><footer class="bg-dark py-5 row d-print-none">
<div class="container-fluid mx-sm-5">
<div class="row">
<div class="col-6 col-sm-4 text-xs-center order-sm-2">
</div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
<a class="text-white" target="_blank" rel="noopener" href="https://github.com/banzaicloud/bank-vaults" aria-label="GitHub">
<i class="fab fa-github"></i>
</a>
</li><li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
<a class="text-white" target="_blank" rel="noopener" href="https://eti.cisco.com/slack" aria-label="Slack">
<i class="fab fa-slack"></i>
</a>
</li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2">
<small class="text-white">&copy; 2023 Bank-Vaults maintainers All Rights Reserved</small>
</div></div></div></footer></div><script src="/js/main.min.2aff983e9d0d8ecff9ed53e14b657216e2d8d2aff059bf4a5651283020995f1b.js" integrity="sha256-Kv+YPp0Njs/57VPhS2VyFuLY0q/wWb9KVlEoMCCZXxs=" crossorigin="anonymous"></script>
<script src='/js/prism.js'></script>
<script src='/js/tabpane-persist.js'></script>
<script src="/js/tocbot.min.js"></script>
<script type="text/javascript">tocbot.init({tocSelector:".td-toc",contentSelector:".td-content",headingSelector:"h2, h3, h4",ignoreHiddenElements:!0})</script>
</body></html>