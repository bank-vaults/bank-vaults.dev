<!doctype html><html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name="generator" content="Hugo 0.110.0">
<link rel="canonical" type="text/html" href="https://bank-vaults.dev/docs/installing/">
<link rel="alternate" type="text/releases" href="https://bank-vaults.dev/docs/installing/releases.releases">
<meta name="robots" content="noindex, nofollow">
<link rel="shortcut icon" href="/favicons/favicon.ico">
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">
<title>Getting started | Bank-Vaults</title><meta name="description" content="Documentation for the Bank-Vaults">
<meta property="og:title" content="Getting started">
<meta property="og:description" content="Documentation for the Bank-Vaults">
<meta property="og:type" content="website">
<meta property="og:url" content="https://bank-vaults.dev/docs/installing/"><meta property="og:site_name" content="Bank-Vaults">
<meta itemprop="name" content="Getting started">
<meta itemprop="description" content="Documentation for the Bank-Vaults"><meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Getting started">
<meta name="twitter:description" content="Documentation for the Bank-Vaults">
<meta name="twitter:site" content="@calisti12">
<link rel="preload" href="/scss/main.min.676617caf057b12362ecf7673d65047c5fe898a6461e02d928249cbc94b1bdab.css" as="style">
<link href="/scss/main.min.676617caf057b12362ecf7673d65047c5fe898a6461e02d928249cbc94b1bdab.css" rel="stylesheet" integrity>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK" crossorigin="anonymous"></script>
<script defer src="https://unpkg.com/lunr@2.3.9/lunr.min.js" integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli" crossorigin="anonymous"></script>
<link rel="stylesheet" href="/css/prism.css">
<script src="/js/w3.js" type="application/x-javascript"></script>
</head><body class="td-section">
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
<a class="navbar-brand" href="/"><span class="navbar-brand__logo navbar-logo"><svg width="144.26347" height="144.26346" viewBox="0 0 144.26348 144.26346" id="svg70" sodipodi:docname="logo.svg" inkscape:version="1.2.1 (9c6d41e4, 2022-07-14)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/"><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="1309" inkscape:window-height="456" id="namedview72" showgrid="false" inkscape:zoom="1.4142136" inkscape:cx="252.79067" inkscape:cy="89.095452" inkscape:window-x="0" inkscape:window-y="25" inkscape:window-maximized="0" inkscape:current-layer="g89" showguides="true" inkscape:guide-bbox="true" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:showpageshadow="0" inkscape:pagecheckerboard="1" inkscape:deskcolor="#d1d1d1"/><defs id="defs4"><style id="style2">.cls-1{fill:#36a8e1}</style><linearGradient gradientTransform="matrix(1,0,0,-1,539,276.5)" y2="276.63062" x2="-493.32941" y1="231.5972" x1="-498.4776" gradientUnits="userSpaceOnUse" id="SVGID_1_"><stop id="stop1134" style="stop-color:#3C8ECD" offset=".4032"/><stop id="stop1136" style="stop-color:#82CEF2" offset=".9943"/></linearGradient><linearGradient gradientTransform="matrix(1,0,0,-1,539,276.5)" y2="271.8768" x2="-515.39728" y1="233.5062" x1="-511.01059" gradientUnits="userSpaceOnUse" id="SVGID_2_"><stop id="stop1141" style="stop-color:#C18DBE" offset=".4032"/><stop id="stop1143" style="stop-color:#9DB4DD" offset="1"/></linearGradient><linearGradient gradientTransform="matrix(1,0,0,-1,539,276.5)" y2="282.21011" x2="-499.84381" y1="229.3567" x1="-493.8013" gradientUnits="userSpaceOnUse" id="SVGID_3_"><stop id="stop1148" style="stop-color:#454494" offset=".4032"/><stop id="stop1150" style="stop-color:#76A1D6" offset="1"/></linearGradient><linearGradient gradientTransform="matrix(1,0,0,-1,539,276.5)" y2="267.82639" x2="-470.24661" y1="235.1331" x1="-473.98431" gradientUnits="userSpaceOnUse" id="SVGID_4_"><stop id="stop1155" style="stop-color:#56BDC1" offset=".4032"/><stop id="stop1157" style="stop-color:#82CEF2" offset=".9943"/></linearGradient><linearGradient gradientTransform="matrix(1,0,0,-1,539,276.5)" y2="260.12711" x2="-494.45529" y1="229.73219" x1="-492.93121" gradientUnits="userSpaceOnUse" id="SVGID_5_"><stop id="stop1162" style="stop-color:#13287A" offset=".0057"/><stop id="stop1164" style="stop-color:#1A3D8E" offset="1"/></linearGradient><linearGradient gradientTransform="matrix(1,0,0,-1,539,276.5)" y2="235.2251" x2="-507.06671" y1="273.6745" x1="-512.83838" gradientUnits="userSpaceOnUse" id="SVGID_6_"><stop id="stop1169" style="stop-color:#466BB3" offset="0"/><stop id="stop1171" style="stop-color:#3C3079" offset=".7268"/></linearGradient><linearGradient gradientTransform="matrix(1,0,0,-1,539,276.5)" y2="266.69089" x2="-476.4068" y1="238.7536" x1="-482.8345" gradientUnits="userSpaceOnUse" id="SVGID_7_"><stop id="stop1176" style="stop-color:#1972A0" offset=".1924"/><stop id="stop1178" style="stop-color:#3B9FD9" offset="1"/></linearGradient></defs><g id="g2191-6" transform="matrix(1.0391419,0,0,1.0391419,-785.98152,-409.33734)"/><g id="g378" transform="matrix(0.21956619,0,0,0.21956619,-62.665715,99.533341)"><g id="g89" transform="matrix(0.96603773,0,0,0.96603773,0,19.798907)"><rect transform="matrix(4.5544353,0,0,4.5544353,0,-623.95763)" inkscape:export-ydpi="83.459999" inkscape:export-xdpi="83.459999" y="0" x="0" height="265" width="279.07285" id="rect1490-6" style="opacity:1;vector-effect:none;fill:none;fill-opacity:1;stroke:none;stroke-width:.540616;stroke-linecap:butt;stroke-linejoin:bevel;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;paint-order:stroke fill markers"/><g transform="matrix(2.2671253,0,0,2.2671253,-1470.9633,-791.56917)" id="g465-0"><path inkscape:connector-curvature="0" id="path218-5-3" d="m1079.1383 283.12854a150 150 0 01-150.00003 150 150 150 0 01-150-150 150 150 0 01150-150 150 150 0 01150.00003 150z" style="opacity:1;vector-effect:none;fill:#36a8e1;fill-opacity:1;stroke:none;stroke-width:1.59412;stroke-linecap:butt;stroke-linejoin:bevel;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;paint-order:stroke fill markers"/><g transform="matrix(2.0690654,0,0,2.0690654,739.12048,-2709.7574)" id="g1372-0-6"><path id="Path_1631-8-3-1" d="m140.98383 1464.3453c-.23051-1e-4-.46029-.026-.68499-.077l-25.05227-5.7194.12354-.2651c1.52748-3.2666 2.35115-6.818 2.41755-10.4236l.006-.2901 25.014 5.7107c.79405.1802 1.48298.6706 1.91325 1.362.43597.6876.57876 1.5212.39658 2.3148l-1.14156 5.0004c-.18024.794-.67067 1.483-1.36196 1.9133-.48769.3088-1.05281.4733-1.63004.4745z" class="cls-1" data-name="Path 1631" inkscape:connector-curvature="0" style="fill:#fff;stroke-width:.236204" sodipodi:nodetypes="ccccccccccccc"/><path id="Path_1632-4-6-0" d="m42.692762 1464.3453c-1.431928.0-2.67294-.9922-2.993412-2.3878l-1.141574-5.0004c-.182495-.7936-.03976-1.6272.396351-2.3149.43031-.6912 1.11923-1.1816 1.913251-1.3619l25.027696-5.7136.0056.2898c.06623 3.6055.889568 7.1567 2.416603 10.4235l.123771.265-25.064544 5.7224c-.224287.051-.453658.078-.683811.078z" class="cls-1" data-name="Path 1632" inkscape:connector-curvature="0" style="fill:#fff;stroke-width:.236204" sodipodi:nodetypes="cccccccccccc"/><path id="Path_1633-8-1-6" d="m86.203652 1421.9854v-25.527c.0018-1.6952 1.375526-3.0689 3.070652-3.0707h5.128931c1.695126.0 3.068839 1.3755 3.070651 3.0707v25.5244l-.284625-.06c-3.528917-.734-7.171122-.734-10.700038.0z" class="cls-1" data-name="Path 1633" inkscape:connector-curvature="0" style="fill:#fff;stroke-width:.236204" sodipodi:nodetypes="ccccccccc"/><path id="Path_1634-1-0-3" d="m68.4782 1436.0192-20.013323-15.9593c-.637548-.507-1.045807-1.2479-1.133778-2.0576-.09463-.8087.138439-1.6218.647198-2.2577l3.197729-4.0099c.506674-.6378 1.24758-1.0461 2.057336-1.1339.808868-.095 1.622095.138 2.257874.647l19.982853 15.9355-.222741.1854c-2.774754 2.3028-5.037618 5.1601-6.643471 8.3886z" class="cls-1" data-name="Path 1634" inkscape:connector-curvature="0" style="fill:#fff;stroke-width:.236204" sodipodi:nodetypes="ccccccccccc"/><path id="Path_1635-0-6-20" d="m111.69006 1497.5553c-1.18101 8e-4-2.25818-.6747-2.77162-1.7383l-11.17906-23.2188.283444-.069c3.503736-.8523 6.788826-2.4326 9.641606-4.6381l.23078-.1776 11.1774 23.2146c.35415.7333.40034 1.5777.12826 2.3453-.26575.7699-.8286 1.4012-1.56296 1.7533l-4.6211 2.2253c-.41379.1996-.8673.3034-1.32675.3035z" class="cls-1" data-name="Path 1635" inkscape:connector-curvature="0" style="fill:#fff;stroke-width:.236204" sodipodi:nodetypes="cccccccccccc"/><path id="Path_1636-3-3-61" d="m71.986066 1497.5553c-.459533.0-.913133-.1036-1.326994-.3035l-4.621331-2.2253c-.734212-.3523-1.297005-.9837-1.56296-1.7533-.272113-.7676-.225844-1.612.128494-2.3453l11.180949-23.2221.230772.1778c2.851924 2.2071 6.136543 3.7892 9.64019 4.6431l.283445.069-11.180476 23.2209c-.513556 1.0637-1.590928 1.7393-2.772089 1.7383z" class="cls-1" data-name="Path 1636" inkscape:connector-curvature="0" style="fill:#fff;stroke-width:.236204" sodipodi:nodetypes="cccccccccccc"/><path id="Path_1637-0-2-5" d="m115.20736 1436.0117-.13061-.2615c-1.60686-3.2281-3.87061-6.0848-6.64607-8.3867l-.22298-.1853 19.97672-15.9299c1.32641-1.0555 3.25699-.8379 4.3152.4864l3.19773 4.0099c1.05536 1.3265.8379 3.2569-.48611 4.3153z" class="cls-1" data-name="Path 1637" inkscape:connector-curvature="0" style="fill:#fff;stroke-width:.236204" sodipodi:nodetypes="ccccccccc"/></g><path sodipodi:nodetypes="ccccccccccccccccc" style="fill:#fff;stroke-width:.488708" inkscape:connector-curvature="0" data-name="Path 1611" class="cls-1" d="m953.64449 351.25645v0l-49.11506-.0269c-4.61319.0-8.97664-2.09451-11.8425-5.70793l-30.605-38.41323c-2.88324-3.59976-3.95895-8.32323-2.91945-12.81745l10.95094-47.87714c1.01715-4.50022 4.03882-8.28619 8.20095-10.27663l44.26-21.28965c4.15116-2.00969 8.99505-2.00969 13.14622.0l44.24138 21.33123c4.16027 1.9952 7.17883 5.77994 8.19205 10.28285l10.9077 47.88769c1.03498 4.49504-.0455 9.2183-2.93249 12.81517l-30.64182 38.38551c-2.8669 3.60969-7.22725 5.70937-11.83609 5.69717z" id="path1253-3-0-5"/><path sodipodi:nodetypes="ccccccccccccccccc" style="fill:#36a8e1;fill-opacity:1;stroke-width:.37402" inkscape:connector-curvature="0" data-name="Path 1611" class="cls-1" d="m947.8838 335.07491v0l-37.58892-.0228c-3.53065.0-6.86992-1.60353-9.06334-4.36945L877.8089 301.28397c-2.20666-2.75352-3.02994-6.36941-2.23439-9.80903l8.38096-36.64087c.77838-3.44417 3.09098-6.34189 6.27651-7.86493l33.8735-16.29513c3.17684-1.53773 6.88419-1.53773 10.06103.0l33.85902 16.32575c3.18408 1.52676 5.49399 4.42366 6.26968 7.86969l8.34785 36.64936c.79204 3.43961-.0331 7.0553-2.24431 9.80881l-23.451 29.37577c-2.19404 2.76323-5.53102 4.37048-9.05837 4.36117z" id="path1253-6-4"/><g transform="matrix(0.48872138,0,0,0.48872138,1906.5441,113.88789)" id="Group_365-8-1-7" data-name="Group 365" style="fill:#fff"><path sodipodi:nodetypes="cccccc" id="Path_1612-1-5-6" d="m-2036.06 314.053h-.06c-7.1763-.008-12.9917-5.82372-13-13-.018-7.19712 5.8029-13.04555 13-13.061 7.1967-.0177 13.0446 5.80326 13.06 13 .018 7.19712-5.8029 13.04555-13 13.061z" class="cls-1" data-name="Path 1612" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccccc" id="Path_1613-2-5-5" d="m-1963.88 314.053h-.06c-7.1763-.008-12.9917-5.82372-13-13-.018-7.19712 5.8029-13.04555 13-13.061 7.197-.0183 13.0451 5.80303 13.06 13 .018 7.19712-5.8029 13.04555-13 13.061zm0-24.061c-6.0926-.0188 6.0933.0138.0.0z" class="cls-1" data-name="Path 1613" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1614-9-4-69" d="m-2036.06 350.143h-.06c-7.1763-.008-12.9917-5.82372-13-13-.018-7.19696 5.803-13.04511 13-13.06 7.1967-.0177 13.0446 5.80326 13.06 13 .018 7.19673-5.8033 13.04455-13 13.06z" class="cls-1" data-name="Path 1614" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1615-3-7-3" d="m-1963.88 350.143h-.06c-7.1763-.008-12.9917-5.82372-13-13-.018-7.19673 5.8033-13.04455 13-13.06 7.197-.0183 13.0451 5.80303 13.06 13 .018 7.19696-5.803 13.04511-13 13.06z" class="cls-1" data-name="Path 1615" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1616-9-6-7" d="m-2036.06 386.233h-.06c-7.1763-.008-12.9917-5.82372-13-13-.018-7.19696 5.803-13.04511 13-13.06 7.1967-.0177 13.0446 5.80326 13.06 13 .018 7.19673-5.8033 13.04455-13 13.06z" class="cls-1" data-name="Path 1616" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1617-0-5-4" d="m-1999.97 314.053h-.06c-7.1765-.008-12.9923-5.8235-13-13-.018-7.19712 5.8029-13.04555 13-13.061 7.197-.0183 13.0451 5.80303 13.06 13 .018 7.19712-5.8029 13.04555-13 13.061z" class="cls-1" data-name="Path 1617" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1618-8-6-5" d="m-1999.97 350.143h-.06c-7.1765-.008-12.9923-5.8235-13-13-.018-7.19696 5.803-13.04511 13-13.06 7.197-.0183 13.0451 5.80303 13.06 13 .018 7.19696-5.803 13.04511-13 13.06z" class="cls-1" data-name="Path 1618" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1619-8-9-2" d="m-1999.97 386.233h-.06c-7.1765-.008-12.9923-5.8235-13-13-.018-7.19696 5.803-13.04511 13-13.06 7.197-.0183 13.0451 5.80303 13.06 13 .018 7.19696-5.803 13.04511-13 13.06z" class="cls-1" data-name="Path 1619" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1620-5-3-5" d="m-1999.97 422.323h-.06c-7.1765-.008-12.9923-5.8235-13-13-.018-7.19696 5.803-13.04511 13-13.06 7.197-.0182 13.0451 5.80303 13.06 13 .018 7.19696-5.803 13.04511-13 13.06z" class="cls-1" data-name="Path 1620" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1621-0-7-4" d="m-1963.88 386.233h-.06c-7.1763-.008-12.9917-5.82372-13-13-.018-7.19673 5.8033-13.04455 13-13.06 7.197-.0183 13.0451 5.80303 13.06 13 .018 7.19696-5.803 13.04511-13 13.06z" class="cls-1" data-name="Path 1621" inkscape:connector-curvature="0" style="fill:#fff"/></g></g></g></g></svg></span><span class="navbar-brand__name">Bank-Vaults</span>
<span class="font-weight-bold navbar-logo navbar-version">1.19.0</span></a>
<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
<ul class="navbar-nav mt-2 mt-lg-0">
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link" href="https://github.com/banzaicloud/bank-vaults" target="_blank"><span>Project page</span></a>
</li><li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link" href="/docs/"><span>Documentation</span></a>
</li></ul></div><div class="navbar-nav d-none d-lg-block">
<div class="td-search td-search--offline">
<div class="td-search__icon"></div><input type="search" class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete="off" data-offline-search-index-json-src="/offline-search-index.afb65e5cd5dda894dfde686c0a3300e8.json" data-offline-search-base-href="/" data-offline-search-max-results="10">
</div></div></nav></header><div class="container-fluid td-outer">
<div class="td-main">
<div class="row flex-xl-nowrap">
<main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="return print(),!1">Click here to print</a>.
</p><p>
<a href="/docs/installing/">Return to the regular view of this page</a>.
</p></div><h1 class="title">Getting started</h1><ul>
<li>1: <a href="#pg-fbb24e4e19a4e351b9ef1b63f7a64769">Deploy vault into a custom namespace</a></li></ul><div class="content">
<p>Bank-Vaults is a swiss-army knife with multiple manifestations, so the first steps depend on what you want to achieve.
Check one of the following guides to get an overview:</p><ul>
<li><a href="https://techblog.cisco.com/vault-dynamic-secrets/">Dynamic credentials with Vault using Kubernetes Service Accounts</a></li><li><a href="https://techblog.cisco.com/vault-operator/">Vault Operator</a></li><li><a href="https://techblog.cisco.com/vault-unsealing/">Vault unseal flow with KMS</a></li><li><a href="https://techblog.cisco.com/monitoring-vault-grafana/">Monitoring Vault on Kubernetes using Cloud Native technologies</a></li><li><a href="https://techblog.cisco.com/inject-secrets-into-pods-vault-revisited/">Inject secrets directly into pods from Vault</a></li></ul><h2 id="deploy-with-helm">Deploy with Helm</h2><p>We have some fully fledged, production-ready Helm charts for deploying:</p><ul>
<li><a href="https://github.com/bank-vaults/bank-vaults/tree/master/charts/vault">Vault</a> using <code>bank-vaults</code>,</li><li>the <a href="https://github.com/bank-vaults/bank-vaults/tree/master/charts/vault-operator">Vault Operator</a>, and also</li><li>the <a href="https://github.com/bank-vaults/bank-vaults/tree/master/charts/vault-secrets-webhook">Vault Secrets Webhook</a>.</li></ul><p>With the help of these charts you can run a HA Vault instance with automatic initialization, unsealing, and external configuration which would otherwise be a tedious manual operation. Also secrets from Vault can be injected into your Pods directly as environment variables (without using Kubernetes Secrets). These charts can be used easily for development purposes as well.</p><blockquote>
<p>Note: Starting with Bank-Vaults version 1.6.0, only Helm 3 is supported. If you have installed the chart with Helm 2 and now you are trying to upgrade with Helm3, see the <a href="https://github.com/bank-vaults/bank-vaults/releases/tag/1.6.0">Bank-Vaults 1.6.0 release notes</a> for detailed instructions.</p></blockquote><h2 id="deploy-operator">Deploy a local Vault operator</h2><p>This is the simplest scenario: you install the Vault operator on a simple cluster. The following commands install a single-node Vault instance that stores unseal and root tokens in Kubernetes secrets.</p><ol>
<li>
<p>Install the Bank-Vaults operator:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>helm repo add banzaicloud-stable https://kubernetes-charts.banzaicloud.com
</span></span><span style="display:flex"><span>helm upgrade --install vault-operator banzaicloud-stable/vault-operator
</span></span></code></pre></div><p>Expected output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>Release <span style="color:#4e9a06">&#34;vault-operator&#34;</span> does not exist. Installing it now.
</span></span><span style="display:flex"><span>NAME: vault-operator
</span></span><span style="display:flex"><span>LAST DEPLOYED: Fri Jul <span style="color:#0000cf;font-weight:700">14</span> 14:41:18 <span style="color:#0000cf;font-weight:700">2023</span>
</span></span><span style="display:flex"><span>NAMESPACE: default
</span></span><span style="display:flex"><span>STATUS: deployed
</span></span><span style="display:flex"><span>REVISION: <span style="color:#0000cf;font-weight:700">1</span>
</span></span><span style="display:flex"><span>TEST SUITE: None
</span></span></code></pre></div></li><li>
<p>Create a Vault instance using the Vault custom resources. This will create a Kubernetes <code>CustomResource</code> called <code>vault</code> and a PersistentVolumeClaim for it:</p><blockquote>
<p>Note: The following commands use a specific version of the CRs, because the current version is not yet working, as we are in the process of migrating the Bank-Vaults repositories.</p></blockquote><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl apply -f https://raw.githubusercontent.com/banzaicloud/bank-vaults/v1.15.3/operator/deploy/rbac.yaml
</span></span><span style="display:flex"><span>kubectl apply -f https://raw.githubusercontent.com/banzaicloud/bank-vaults/v1.15.3/operator/deploy/cr.yaml
</span></span></code></pre></div></li><li>
<p>Wait a few seconds, then check the operator and the vault pods:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl get pods
</span></span></code></pre></div><p>Expected output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>NAME                                                        READY     STATUS    RESTARTS   AGE
</span></span><span style="display:flex"><span>vault-0                                                     3/3       Running   <span style="color:#0000cf;font-weight:700">0</span>          10s
</span></span><span style="display:flex"><span>vault-configurer-6c545cb6b4-dmvb5                           1/1       Running   <span style="color:#0000cf;font-weight:700">0</span>          10s
</span></span><span style="display:flex"><span>vault-operator-788559bdc5-kgqkg                             1/1       Running   <span style="color:#0000cf;font-weight:700">0</span>          23s
</span></span></code></pre></div></li><li>
<p>Configure your Vault client to access the Vault instance running in the <em>vault-0</em> pod.</p><ol>
<li>
<p>Port-forward into the pod:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl port-forward vault-0 <span style="color:#0000cf;font-weight:700">8200</span> <span style="color:#000;font-weight:700">&amp;</span>
</span></span></code></pre></div></li><li>
<p>Set the address of the Vault instance.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span><span style="color:#204a87">export</span> <span style="color:#000">VAULT_ADDR</span><span style="color:#ce5c00;font-weight:700">=</span>https://127.0.0.1:8200
</span></span></code></pre></div></li><li>
<p>Import the CA certificate of the Vault instance by running the following commands (otherwise, you&rsquo;ll get <em>x509: certificate signed by unknown authority</em> errors):</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl get secret vault-tls -o <span style="color:#000">jsonpath</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;{.data.ca\.crt}&#34;</span> <span style="color:#000;font-weight:700">|</span> base64 --decode &gt; <span style="color:#000">$PWD</span>/vault-ca.crt
</span></span><span style="display:flex"><span><span style="color:#204a87">export</span> <span style="color:#000">VAULT_CACERT</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#000">$PWD</span>/vault-ca.crt
</span></span></code></pre></div><p>Alternatively, you can instruct the Vault client to skip verifying the certificate of Vault by running: <code>export VAULT_SKIP_VERIFY=true</code></p></li><li>
<p>If you already have the <a href="https://developer.hashicorp.com/vault/downloads">Vault CLI installed</a>, check that you can access the Vault:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>vault status
</span></span></code></pre></div><p>Expected output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>Key             Value
</span></span><span style="display:flex"><span>---             -----
</span></span><span style="display:flex"><span>Seal Type       shamir
</span></span><span style="display:flex"><span>Initialized     <span style="color:#204a87">true</span>
</span></span><span style="display:flex"><span>Sealed          <span style="color:#204a87">false</span>
</span></span><span style="display:flex"><span>Total Shares    <span style="color:#0000cf;font-weight:700">5</span>
</span></span><span style="display:flex"><span>Threshold       <span style="color:#0000cf;font-weight:700">3</span>
</span></span><span style="display:flex"><span>Version         1.5.4
</span></span><span style="display:flex"><span>Cluster Name    vault-cluster-27ecd0e6
</span></span><span style="display:flex"><span>Cluster ID      ed5492f3-7ef3-c600-aef3-bd77897fd1e7
</span></span><span style="display:flex"><span>HA Enabled      <span style="color:#204a87">false</span>
</span></span></code></pre></div></li><li>
<p>To authenticate to Vault, you can access its root token by running:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span><span style="color:#204a87">export</span> <span style="color:#000">VAULT_TOKEN</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#204a87;font-weight:700">$(</span>kubectl get secrets vault-unseal-keys -o <span style="color:#000">jsonpath</span><span style="color:#ce5c00;font-weight:700">={</span>.data.vault-root<span style="color:#ce5c00;font-weight:700">}</span> <span style="color:#000;font-weight:700">|</span> base64 --decode<span style="color:#204a87;font-weight:700">)</span>
</span></span></code></pre></div><blockquote>
<p>Note: Using the root token is recommended only in test environments. In production environment, create dedicated, time-limited tokens.</p></blockquote></li><li>
<p>Now you can interact with Vault. For example, add a secret by running <code>vault kv put secret/demosecret/aws AWS_SECRET_ACCESS_KEY=s3cr3t</code>
If you want to access the Vault web interface, open <em>https://127.0.0.1:8200</em> in your browser using the root token (to reveal the token, run <code>echo $VAULT_TOKEN</code>).</p></li></ol></li></ol><p>For other configuration examples of the Vault CustomResource, see the YAML files in the <a href="https://github.com/bank-vaults/bank-vaults/tree/master/operator/deploy">operator/deploy directory of the project</a> (we use these for testing). After you are done experimenting with Bank-Vaults and you want to delete the operator, you can delete the related CRs:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl delete -f https://raw.githubusercontent.com/banzaicloud/bank-vaults/master/operator/deploy/rbac.yaml
</span></span><span style="display:flex"><span>kubectl delete -f https://raw.githubusercontent.com/banzaicloud/bank-vaults/master/operator/deploy/cr.yaml
</span></span></code></pre></div><h2 id="deploy-the-mutating-webhook">Deploy the mutating webhook</h2><p>You can deploy the Vault Secrets Webhook using Helm. Note that:</p><ul>
<li>The Helm chart of the vault-secrets-webhook contains the templates of the required permissions as well.</li><li>The deployed RBAC objects contain the necessary permissions fo running the webhook.</li></ul><h3 id="prerequisites">Prerequisites</h3><ul>
<li>The user you use for deploying the chart to the Kubernetes cluster must have cluster-admin privileges.</li><li>The chart requires Helm 3.</li><li>To interact with Vault (for example, for testing), the <em>vault</em> command line client must be installed on your computer.</li><li>You have deployed Vault with the operator and configured your Vault client to access it, as described in <a href="/docs/installing/#deploy-operator">Deploy a local Vault operator</a>.</li></ul><h3 id="deploy-the-webhook">Deploy the webhook</h3><ol>
<li>
<p>Create a namespace for the webhook and add a label to the namespace, for example, <em>vault-infra</em>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl create namespace vault-infra
</span></span><span style="display:flex"><span>kubectl label namespace vault-infra <span style="color:#000">name</span><span style="color:#ce5c00;font-weight:700">=</span>vault-infra
</span></span></code></pre></div></li><li>
<p>Deploy the vault-secrets-webhook chart:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>helm repo add banzaicloud-stable https://kubernetes-charts.banzaicloud.com
</span></span><span style="display:flex"><span>helm upgrade --namespace vault-infra --install vault-secrets-webhook banzaicloud-stable/vault-secrets-webhook
</span></span></code></pre></div><p>Expected output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>Release <span style="color:#4e9a06">&#34;vault-secrets-webhook&#34;</span> does not exist. Installing it now.
</span></span><span style="display:flex"><span>NAME: vault-secrets-webhook
</span></span><span style="display:flex"><span>LAST DEPLOYED: Fri Jul <span style="color:#0000cf;font-weight:700">14</span> 15:42:36 <span style="color:#0000cf;font-weight:700">2023</span>
</span></span><span style="display:flex"><span>NAMESPACE: vault-infra
</span></span><span style="display:flex"><span>STATUS: deployed
</span></span><span style="display:flex"><span>REVISION: <span style="color:#0000cf;font-weight:700">1</span>
</span></span><span style="display:flex"><span>TEST SUITE: None
</span></span></code></pre></div><p>For further details, see the <a href="https://github.com/bank-vaults/bank-vaults/tree/master/charts/vault-secrets-webhook">webhook&rsquo;s Helm chart repository</a>.</p></li><li>
<p>Check that the pods are running:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl get pods --namespace vault-infra
</span></span></code></pre></div><p>Expected output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>NAME                                     READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex"><span>vault-secrets-webhook-58b97c8d6d-qfx8c   1/1     Running   <span style="color:#0000cf;font-weight:700">0</span>          22s
</span></span><span style="display:flex"><span>vault-secrets-webhook-58b97c8d6d-rthgd   1/1     Running   <span style="color:#0000cf;font-weight:700">0</span>          22s
</span></span></code></pre></div></li><li>
<p>If you already have the <a href="https://developer.hashicorp.com/vault/downloads">Vault CLI installed</a>, write a secret into Vault:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>vault kv put secret/demosecret/aws <span style="color:#000">AWS_SECRET_ACCESS_KEY</span><span style="color:#ce5c00;font-weight:700">=</span>s3cr3t
</span></span></code></pre></div><p>Expected output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>Key              Value
</span></span><span style="display:flex"><span>---              -----
</span></span><span style="display:flex"><span>created_time     2020-11-04T11:39:01.863988395Z
</span></span><span style="display:flex"><span>deletion_time    n/a
</span></span><span style="display:flex"><span>destroyed        <span style="color:#204a87">false</span>
</span></span><span style="display:flex"><span>version          <span style="color:#0000cf;font-weight:700">1</span>
</span></span></code></pre></div></li><li>
<p>Apply the following deployment to your cluster. The webhook will mutate this deployment because it has an environment variable having a value which is a reference to a path in Vault:</p><pre>
    <code class="language-yaml">kubectl create -f - &lt;&lt;EOF
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: vault-test
    spec:
      replicas: 1
      selector:
        matchLabels:
          app.kubernetes.io/name: vault
      template:
        metadata:
          labels:
            app.kubernetes.io/name: vault
          annotations:
            vault.security.banzaicloud.io/vault-addr: &#34;https://vault:8200&#34; # optional, the address of the Vault service, default values is https://vault:8200
            vault.security.banzaicloud.io/vault-role: &#34;default&#34; # optional, the default value is the name of the ServiceAccount the Pod runs in, in case of Secrets and ConfigMaps it is &#34;default&#34;
            vault.security.banzaicloud.io/vault-skip-verify: &#34;false&#34; # optional, skip TLS verification of the Vault server certificate
            vault.security.banzaicloud.io/vault-tls-secret: &#34;vault-tls&#34; # optional, the name of the Secret where the Vault CA cert is, if not defined it is not mounted
            vault.security.banzaicloud.io/vault-agent: &#34;false&#34; # optional, if true, a Vault Agent will be started to do Vault authentication, by default not needed and vault-env will do Kubernetes Service Account based Vault authentication
            vault.security.banzaicloud.io/vault-path: &#34;kubernetes&#34; # optional, the Kubernetes Auth mount path in Vault the default value is &#34;kubernetes&#34;
        spec:
          serviceAccountName: default
          containers:
          - name: alpine
            image: alpine
            command: [&#34;sh&#34;, &#34;-c&#34;, &#34;echo $AWS_SECRET_ACCESS_KEY &amp;&amp; echo going to sleep... &amp;&amp; sleep 10000&#34;]
            env:
            - name: AWS_SECRET_ACCESS_KEY
              value: vault:secret/data/demosecret/aws#AWS_SECRET_ACCESS_KEY
    EOF</code>
    </pre><p>Expected output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>deployment.apps/vault-test created
</span></span></code></pre></div></li><li>
<p>Check the mutated deployment.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl describe deployment vault-test
</span></span></code></pre></div><p>The output should look similar to the following:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">Name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">                   </span><span style="color:#000">vault-test</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">Namespace</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#000">default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">CreationTimestamp</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#000">Wed, 04 Nov 2020 12:44:18 +0100</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">Labels</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">                 </span><span style="color:#000">&lt;none&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">Annotations:            deployment.kubernetes.io/revision</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">Selector</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#000">app.kubernetes.io/name=vault</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">Replicas</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">desired | 1 updated | 1 total | 1 available | 0 unavailable</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">StrategyType</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">           </span><span style="color:#000">RollingUpdate</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">MinReadySeconds</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#0000cf;font-weight:700">0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">RollingUpdateStrategy</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#0000cf;font-weight:700">25</span><span style="color:#000">% max unavailable, 25% max surge</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">Pod Template</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">Labels</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">           </span><span style="color:#000">app.kubernetes.io/name=vault</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">Annotations:      vault.security.banzaicloud.io/vault-addr</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://vault:8200</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#204a87;font-weight:700">vault.security.banzaicloud.io/vault-agent</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:700">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#204a87;font-weight:700">vault.security.banzaicloud.io/vault-path</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kubernetes</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#204a87;font-weight:700">vault.security.banzaicloud.io/vault-role</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#204a87;font-weight:700">vault.security.banzaicloud.io/vault-skip-verify</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:700">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#204a87;font-weight:700">vault.security.banzaicloud.io/vault-tls-secret</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">vault-tls</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">Service Account</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">Containers</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:700">alpine</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">Image</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#000">alpine</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">Port</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#000">&lt;none&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">Host Port</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">&lt;none&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">Command</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#000">sh</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>-<span style="color:#000">c</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#000">echo $AWS_SECRET_ACCESS_KEY &amp;&amp; echo going to sleep... &amp;&amp; sleep 10000</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">Environment</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">AWS_SECRET_ACCESS_KEY</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">vault:secret/data/demosecret/aws#AWS_SECRET_ACCESS_KEY</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">Mounts</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">                   </span><span style="color:#000">&lt;none&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">Volumes</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#000">&lt;none&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">Conditions</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">Type           Status  Reason</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>---- <span style="color:#f8f8f8;text-decoration:underline">          </span>------ <span style="color:#f8f8f8;text-decoration:underline"> </span>------<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">Available      True    MinimumReplicasAvailable</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">Progressing    True    NewReplicaSetAvailable</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">OldReplicaSets</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">&lt;none&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">NewReplicaSet</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">vault-test-55c569f9 (1/1 replicas created)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">Events</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">Type    Reason             Age   From                   Message</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>---- <span style="color:#f8f8f8;text-decoration:underline">   </span>------ <span style="color:#f8f8f8;text-decoration:underline">            </span>---- <span style="color:#f8f8f8;text-decoration:underline"> </span>---- <span style="color:#f8f8f8;text-decoration:underline">                  </span>-------<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">Normal  ScalingReplicaSet  29s   deployment-controller  Scaled up replica set vault-test-55c569f9 to 1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>As you can see, the original environment variables in the definition are unchanged, and the sensitive value of the AWS_SECRET_ACCESS_KEY variable is only visible within the alpine container.</p></li></ol><h2 id="install-the-cli-tool">Install the CLI tool</h2><p>On macOs, you can directly install the CLI from Homebrew:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>brew install banzaicloud/tap/bank-vaults
</span></span></code></pre></div><p>Alternatively, fetch the source code and compile it using go get:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>go get github.com/bank-vaults/bank-vaults/cmd/bank-vaults
</span></span><span style="display:flex"><span>go get github.com/bank-vaults/bank-vaults/cmd/vault-env
</span></span></code></pre></div><h2 id="docker-images">Docker images</h2><p>If you want to build upon our Docker images, you can find them on Docker Hub:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>docker pull banzaicloud/bank-vaults
</span></span><span style="display:flex"><span>docker pull banzaicloud/vault-operator
</span></span><span style="display:flex"><span>docker pull banzaicloud/vault-env
</span></span></code></pre></div></div></div><div class="td-content" style="page-break-before:always">
<h1 id="pg-fbb24e4e19a4e351b9ef1b63f7a64769">1 - Deploy vault into a custom namespace</h1><p>To deploy vault into a custom namespace (not into <code>default</code>), you have to deploy the vault CustomResource to the custom namespace. Also, you have to use the custom namespace in the following fields:</p><p>In the RBAC resources:</p><ul>
<li><a href="https://github.com/bank-vaults/bank-vaults/blob/master/operator/deploy/rbac.yaml#L49">subjects.namespace of the ClusterRoleBinding</a></li></ul><p>In the Vault CR:</p><ul>
<li><a href="https://github.com/bank-vaults/bank-vaults/blob/master/operator/deploy/cr.yaml#L101">unsealConfig.kubernetes.secretNamespace</a></li><li><a href="https://github.com/bank-vaults/bank-vaults/blob/master/operator/deploy/cr.yaml#L155-L157">secrets.configuration.config.issuing_certificates and crl_distribution_points:</a></li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none">
<div class="container-fluid mx-sm-5">
<div class="row">
<div class="col-6 col-sm-4 text-xs-center order-sm-2">
</div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
<a class="text-white" target="_blank" rel="noopener" href="https://github.com/banzaicloud/bank-vaults" aria-label="GitHub">
<i class="fab fa-github"></i>
</a>
</li><li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
<a class="text-white" target="_blank" rel="noopener" href="https://eti.cisco.com/slack" aria-label="Slack">
<i class="fab fa-slack"></i>
</a>
</li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2">
<small class="text-white">&copy; 2023 Bank-Vaults maintainers All Rights Reserved</small>
</div></div></div></footer></div><script src="/js/main.min.2aff983e9d0d8ecff9ed53e14b657216e2d8d2aff059bf4a5651283020995f1b.js" integrity="sha256-Kv+YPp0Njs/57VPhS2VyFuLY0q/wWb9KVlEoMCCZXxs=" crossorigin="anonymous"></script>
<script src='/js/prism.js'></script>
<script src='/js/tabpane-persist.js'></script>
<script src="/js/tocbot.min.js"></script>
<script type="text/javascript">tocbot.init({tocSelector:".td-toc",contentSelector:".td-content",headingSelector:"h2, h3, h4",ignoreHiddenElements:!0})</script>
</body></html>