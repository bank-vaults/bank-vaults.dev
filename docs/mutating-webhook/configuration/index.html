<!doctype html><html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name="generator" content="Hugo 0.110.0">
<link rel="alternate" type="text/releases" href="https://bank-vaults.dev/docs/mutating-webhook/configuration/releases.releases">
<meta name="robots" content="index, follow">
<link rel="shortcut icon" href="/favicons/favicon.ico">
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">
<title>Configuration examples and scenarios | Bank-Vaults</title><meta name="description" content="The following examples show you how to configure the mutating webhook to best suit your environment.
The webhook checks if a container has environment variables defined in the following formats, and reads the values for those variables directly from Vault during startup time.
env: - name: AWS_SECRET_ACCESS_KEY value: vault:secret/data/accounts/aws#AWS_SECRET_ACCESS_KEY # or - name: AWS_SECRET_ACCESS_KEY valueFrom: secretKeyRef: name: aws-key-secret key: AWS_SECRET_ACCESS_KEY # or - name: AWS_SECRET_ACCESS_KEY valueFrom: configMapKeyRef: name: aws-key-configmap key: AWS_SECRET_ACCESS_KEY The webhook checks if a container has envFrom and parses the defined ConfigMaps and Secrets:">
<meta property="og:title" content="Configuration examples and scenarios">
<meta property="og:description" content="The following examples show you how to configure the mutating webhook to best suit your environment.
The webhook checks if a container has environment variables defined in the following formats, and reads the values for those variables directly from Vault during startup time.
env: - name: AWS_SECRET_ACCESS_KEY value: vault:secret/data/accounts/aws#AWS_SECRET_ACCESS_KEY # or - name: AWS_SECRET_ACCESS_KEY valueFrom: secretKeyRef: name: aws-key-secret key: AWS_SECRET_ACCESS_KEY # or - name: AWS_SECRET_ACCESS_KEY valueFrom: configMapKeyRef: name: aws-key-configmap key: AWS_SECRET_ACCESS_KEY The webhook checks if a container has envFrom and parses the defined ConfigMaps and Secrets:">
<meta property="og:type" content="article">
<meta property="og:url" content="https://bank-vaults.dev/docs/mutating-webhook/configuration/"><meta property="article:section" content="docs">
<meta property="article:modified_time" content="2023-07-25T16:39:54+02:00"><meta property="og:site_name" content="Bank-Vaults">
<meta itemprop="name" content="Configuration examples and scenarios">
<meta itemprop="description" content="The following examples show you how to configure the mutating webhook to best suit your environment.
The webhook checks if a container has environment variables defined in the following formats, and reads the values for those variables directly from Vault during startup time.
env: - name: AWS_SECRET_ACCESS_KEY value: vault:secret/data/accounts/aws#AWS_SECRET_ACCESS_KEY # or - name: AWS_SECRET_ACCESS_KEY valueFrom: secretKeyRef: name: aws-key-secret key: AWS_SECRET_ACCESS_KEY # or - name: AWS_SECRET_ACCESS_KEY valueFrom: configMapKeyRef: name: aws-key-configmap key: AWS_SECRET_ACCESS_KEY The webhook checks if a container has envFrom and parses the defined ConfigMaps and Secrets:">
<meta itemprop="dateModified" content="2023-07-25T16:39:54+02:00">
<meta itemprop="wordCount" content="1760">
<meta itemprop="keywords" content><meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Configuration examples and scenarios">
<meta name="twitter:description" content="The following examples show you how to configure the mutating webhook to best suit your environment.
The webhook checks if a container has environment variables defined in the following formats, and reads the values for those variables directly from Vault during startup time.
env: - name: AWS_SECRET_ACCESS_KEY value: vault:secret/data/accounts/aws#AWS_SECRET_ACCESS_KEY # or - name: AWS_SECRET_ACCESS_KEY valueFrom: secretKeyRef: name: aws-key-secret key: AWS_SECRET_ACCESS_KEY # or - name: AWS_SECRET_ACCESS_KEY valueFrom: configMapKeyRef: name: aws-key-configmap key: AWS_SECRET_ACCESS_KEY The webhook checks if a container has envFrom and parses the defined ConfigMaps and Secrets:">
<meta name="twitter:site" content="@calisti12">
<link rel="preload" href="/scss/main.min.676617caf057b12362ecf7673d65047c5fe898a6461e02d928249cbc94b1bdab.css" as="style">
<link href="/scss/main.min.676617caf057b12362ecf7673d65047c5fe898a6461e02d928249cbc94b1bdab.css" rel="stylesheet" integrity>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK" crossorigin="anonymous"></script>
<script defer src="https://unpkg.com/lunr@2.3.9/lunr.min.js" integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli" crossorigin="anonymous"></script>
<link rel="stylesheet" href="/css/prism.css">
<script src="/js/w3.js" type="application/x-javascript"></script>
</head><body class="td-page">
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
<a class="navbar-brand" href="/"><span class="navbar-brand__logo navbar-logo"><svg width="144.26347" height="144.26346" viewBox="0 0 144.26348 144.26346" id="svg70" sodipodi:docname="logo.svg" inkscape:version="1.2.1 (9c6d41e4, 2022-07-14)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/"><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="1309" inkscape:window-height="456" id="namedview72" showgrid="false" inkscape:zoom="1.4142136" inkscape:cx="252.79067" inkscape:cy="89.095452" inkscape:window-x="0" inkscape:window-y="25" inkscape:window-maximized="0" inkscape:current-layer="g89" showguides="true" inkscape:guide-bbox="true" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:showpageshadow="0" inkscape:pagecheckerboard="1" inkscape:deskcolor="#d1d1d1"/><defs id="defs4"><style id="style2">.cls-1{fill:#36a8e1}</style><linearGradient gradientTransform="matrix(1,0,0,-1,539,276.5)" y2="276.63062" x2="-493.32941" y1="231.5972" x1="-498.4776" gradientUnits="userSpaceOnUse" id="SVGID_1_"><stop id="stop1134" style="stop-color:#3C8ECD" offset=".4032"/><stop id="stop1136" style="stop-color:#82CEF2" offset=".9943"/></linearGradient><linearGradient gradientTransform="matrix(1,0,0,-1,539,276.5)" y2="271.8768" x2="-515.39728" y1="233.5062" x1="-511.01059" gradientUnits="userSpaceOnUse" id="SVGID_2_"><stop id="stop1141" style="stop-color:#C18DBE" offset=".4032"/><stop id="stop1143" style="stop-color:#9DB4DD" offset="1"/></linearGradient><linearGradient gradientTransform="matrix(1,0,0,-1,539,276.5)" y2="282.21011" x2="-499.84381" y1="229.3567" x1="-493.8013" gradientUnits="userSpaceOnUse" id="SVGID_3_"><stop id="stop1148" style="stop-color:#454494" offset=".4032"/><stop id="stop1150" style="stop-color:#76A1D6" offset="1"/></linearGradient><linearGradient gradientTransform="matrix(1,0,0,-1,539,276.5)" y2="267.82639" x2="-470.24661" y1="235.1331" x1="-473.98431" gradientUnits="userSpaceOnUse" id="SVGID_4_"><stop id="stop1155" style="stop-color:#56BDC1" offset=".4032"/><stop id="stop1157" style="stop-color:#82CEF2" offset=".9943"/></linearGradient><linearGradient gradientTransform="matrix(1,0,0,-1,539,276.5)" y2="260.12711" x2="-494.45529" y1="229.73219" x1="-492.93121" gradientUnits="userSpaceOnUse" id="SVGID_5_"><stop id="stop1162" style="stop-color:#13287A" offset=".0057"/><stop id="stop1164" style="stop-color:#1A3D8E" offset="1"/></linearGradient><linearGradient gradientTransform="matrix(1,0,0,-1,539,276.5)" y2="235.2251" x2="-507.06671" y1="273.6745" x1="-512.83838" gradientUnits="userSpaceOnUse" id="SVGID_6_"><stop id="stop1169" style="stop-color:#466BB3" offset="0"/><stop id="stop1171" style="stop-color:#3C3079" offset=".7268"/></linearGradient><linearGradient gradientTransform="matrix(1,0,0,-1,539,276.5)" y2="266.69089" x2="-476.4068" y1="238.7536" x1="-482.8345" gradientUnits="userSpaceOnUse" id="SVGID_7_"><stop id="stop1176" style="stop-color:#1972A0" offset=".1924"/><stop id="stop1178" style="stop-color:#3B9FD9" offset="1"/></linearGradient></defs><g id="g2191-6" transform="matrix(1.0391419,0,0,1.0391419,-785.98152,-409.33734)"/><g id="g378" transform="matrix(0.21956619,0,0,0.21956619,-62.665715,99.533341)"><g id="g89" transform="matrix(0.96603773,0,0,0.96603773,0,19.798907)"><rect transform="matrix(4.5544353,0,0,4.5544353,0,-623.95763)" inkscape:export-ydpi="83.459999" inkscape:export-xdpi="83.459999" y="0" x="0" height="265" width="279.07285" id="rect1490-6" style="opacity:1;vector-effect:none;fill:none;fill-opacity:1;stroke:none;stroke-width:.540616;stroke-linecap:butt;stroke-linejoin:bevel;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;paint-order:stroke fill markers"/><g transform="matrix(2.2671253,0,0,2.2671253,-1470.9633,-791.56917)" id="g465-0"><path inkscape:connector-curvature="0" id="path218-5-3" d="m1079.1383 283.12854a150 150 0 01-150.00003 150 150 150 0 01-150-150 150 150 0 01150-150 150 150 0 01150.00003 150z" style="opacity:1;vector-effect:none;fill:#36a8e1;fill-opacity:1;stroke:none;stroke-width:1.59412;stroke-linecap:butt;stroke-linejoin:bevel;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;paint-order:stroke fill markers"/><g transform="matrix(2.0690654,0,0,2.0690654,739.12048,-2709.7574)" id="g1372-0-6"><path id="Path_1631-8-3-1" d="m140.98383 1464.3453c-.23051-1e-4-.46029-.026-.68499-.077l-25.05227-5.7194.12354-.2651c1.52748-3.2666 2.35115-6.818 2.41755-10.4236l.006-.2901 25.014 5.7107c.79405.1802 1.48298.6706 1.91325 1.362.43597.6876.57876 1.5212.39658 2.3148l-1.14156 5.0004c-.18024.794-.67067 1.483-1.36196 1.9133-.48769.3088-1.05281.4733-1.63004.4745z" class="cls-1" data-name="Path 1631" inkscape:connector-curvature="0" style="fill:#fff;stroke-width:.236204" sodipodi:nodetypes="ccccccccccccc"/><path id="Path_1632-4-6-0" d="m42.692762 1464.3453c-1.431928.0-2.67294-.9922-2.993412-2.3878l-1.141574-5.0004c-.182495-.7936-.03976-1.6272.396351-2.3149.43031-.6912 1.11923-1.1816 1.913251-1.3619l25.027696-5.7136.0056.2898c.06623 3.6055.889568 7.1567 2.416603 10.4235l.123771.265-25.064544 5.7224c-.224287.051-.453658.078-.683811.078z" class="cls-1" data-name="Path 1632" inkscape:connector-curvature="0" style="fill:#fff;stroke-width:.236204" sodipodi:nodetypes="cccccccccccc"/><path id="Path_1633-8-1-6" d="m86.203652 1421.9854v-25.527c.0018-1.6952 1.375526-3.0689 3.070652-3.0707h5.128931c1.695126.0 3.068839 1.3755 3.070651 3.0707v25.5244l-.284625-.06c-3.528917-.734-7.171122-.734-10.700038.0z" class="cls-1" data-name="Path 1633" inkscape:connector-curvature="0" style="fill:#fff;stroke-width:.236204" sodipodi:nodetypes="ccccccccc"/><path id="Path_1634-1-0-3" d="m68.4782 1436.0192-20.013323-15.9593c-.637548-.507-1.045807-1.2479-1.133778-2.0576-.09463-.8087.138439-1.6218.647198-2.2577l3.197729-4.0099c.506674-.6378 1.24758-1.0461 2.057336-1.1339.808868-.095 1.622095.138 2.257874.647l19.982853 15.9355-.222741.1854c-2.774754 2.3028-5.037618 5.1601-6.643471 8.3886z" class="cls-1" data-name="Path 1634" inkscape:connector-curvature="0" style="fill:#fff;stroke-width:.236204" sodipodi:nodetypes="ccccccccccc"/><path id="Path_1635-0-6-20" d="m111.69006 1497.5553c-1.18101 8e-4-2.25818-.6747-2.77162-1.7383l-11.17906-23.2188.283444-.069c3.503736-.8523 6.788826-2.4326 9.641606-4.6381l.23078-.1776 11.1774 23.2146c.35415.7333.40034 1.5777.12826 2.3453-.26575.7699-.8286 1.4012-1.56296 1.7533l-4.6211 2.2253c-.41379.1996-.8673.3034-1.32675.3035z" class="cls-1" data-name="Path 1635" inkscape:connector-curvature="0" style="fill:#fff;stroke-width:.236204" sodipodi:nodetypes="cccccccccccc"/><path id="Path_1636-3-3-61" d="m71.986066 1497.5553c-.459533.0-.913133-.1036-1.326994-.3035l-4.621331-2.2253c-.734212-.3523-1.297005-.9837-1.56296-1.7533-.272113-.7676-.225844-1.612.128494-2.3453l11.180949-23.2221.230772.1778c2.851924 2.2071 6.136543 3.7892 9.64019 4.6431l.283445.069-11.180476 23.2209c-.513556 1.0637-1.590928 1.7393-2.772089 1.7383z" class="cls-1" data-name="Path 1636" inkscape:connector-curvature="0" style="fill:#fff;stroke-width:.236204" sodipodi:nodetypes="cccccccccccc"/><path id="Path_1637-0-2-5" d="m115.20736 1436.0117-.13061-.2615c-1.60686-3.2281-3.87061-6.0848-6.64607-8.3867l-.22298-.1853 19.97672-15.9299c1.32641-1.0555 3.25699-.8379 4.3152.4864l3.19773 4.0099c1.05536 1.3265.8379 3.2569-.48611 4.3153z" class="cls-1" data-name="Path 1637" inkscape:connector-curvature="0" style="fill:#fff;stroke-width:.236204" sodipodi:nodetypes="ccccccccc"/></g><path sodipodi:nodetypes="ccccccccccccccccc" style="fill:#fff;stroke-width:.488708" inkscape:connector-curvature="0" data-name="Path 1611" class="cls-1" d="m953.64449 351.25645v0l-49.11506-.0269c-4.61319.0-8.97664-2.09451-11.8425-5.70793l-30.605-38.41323c-2.88324-3.59976-3.95895-8.32323-2.91945-12.81745l10.95094-47.87714c1.01715-4.50022 4.03882-8.28619 8.20095-10.27663l44.26-21.28965c4.15116-2.00969 8.99505-2.00969 13.14622.0l44.24138 21.33123c4.16027 1.9952 7.17883 5.77994 8.19205 10.28285l10.9077 47.88769c1.03498 4.49504-.0455 9.2183-2.93249 12.81517l-30.64182 38.38551c-2.8669 3.60969-7.22725 5.70937-11.83609 5.69717z" id="path1253-3-0-5"/><path sodipodi:nodetypes="ccccccccccccccccc" style="fill:#36a8e1;fill-opacity:1;stroke-width:.37402" inkscape:connector-curvature="0" data-name="Path 1611" class="cls-1" d="m947.8838 335.07491v0l-37.58892-.0228c-3.53065.0-6.86992-1.60353-9.06334-4.36945L877.8089 301.28397c-2.20666-2.75352-3.02994-6.36941-2.23439-9.80903l8.38096-36.64087c.77838-3.44417 3.09098-6.34189 6.27651-7.86493l33.8735-16.29513c3.17684-1.53773 6.88419-1.53773 10.06103.0l33.85902 16.32575c3.18408 1.52676 5.49399 4.42366 6.26968 7.86969l8.34785 36.64936c.79204 3.43961-.0331 7.0553-2.24431 9.80881l-23.451 29.37577c-2.19404 2.76323-5.53102 4.37048-9.05837 4.36117z" id="path1253-6-4"/><g transform="matrix(0.48872138,0,0,0.48872138,1906.5441,113.88789)" id="Group_365-8-1-7" data-name="Group 365" style="fill:#fff"><path sodipodi:nodetypes="cccccc" id="Path_1612-1-5-6" d="m-2036.06 314.053h-.06c-7.1763-.008-12.9917-5.82372-13-13-.018-7.19712 5.8029-13.04555 13-13.061 7.1967-.0177 13.0446 5.80326 13.06 13 .018 7.19712-5.8029 13.04555-13 13.061z" class="cls-1" data-name="Path 1612" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccccc" id="Path_1613-2-5-5" d="m-1963.88 314.053h-.06c-7.1763-.008-12.9917-5.82372-13-13-.018-7.19712 5.8029-13.04555 13-13.061 7.197-.0183 13.0451 5.80303 13.06 13 .018 7.19712-5.8029 13.04555-13 13.061zm0-24.061c-6.0926-.0188 6.0933.0138.0.0z" class="cls-1" data-name="Path 1613" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1614-9-4-69" d="m-2036.06 350.143h-.06c-7.1763-.008-12.9917-5.82372-13-13-.018-7.19696 5.803-13.04511 13-13.06 7.1967-.0177 13.0446 5.80326 13.06 13 .018 7.19673-5.8033 13.04455-13 13.06z" class="cls-1" data-name="Path 1614" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1615-3-7-3" d="m-1963.88 350.143h-.06c-7.1763-.008-12.9917-5.82372-13-13-.018-7.19673 5.8033-13.04455 13-13.06 7.197-.0183 13.0451 5.80303 13.06 13 .018 7.19696-5.803 13.04511-13 13.06z" class="cls-1" data-name="Path 1615" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1616-9-6-7" d="m-2036.06 386.233h-.06c-7.1763-.008-12.9917-5.82372-13-13-.018-7.19696 5.803-13.04511 13-13.06 7.1967-.0177 13.0446 5.80326 13.06 13 .018 7.19673-5.8033 13.04455-13 13.06z" class="cls-1" data-name="Path 1616" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1617-0-5-4" d="m-1999.97 314.053h-.06c-7.1765-.008-12.9923-5.8235-13-13-.018-7.19712 5.8029-13.04555 13-13.061 7.197-.0183 13.0451 5.80303 13.06 13 .018 7.19712-5.8029 13.04555-13 13.061z" class="cls-1" data-name="Path 1617" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1618-8-6-5" d="m-1999.97 350.143h-.06c-7.1765-.008-12.9923-5.8235-13-13-.018-7.19696 5.803-13.04511 13-13.06 7.197-.0183 13.0451 5.80303 13.06 13 .018 7.19696-5.803 13.04511-13 13.06z" class="cls-1" data-name="Path 1618" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1619-8-9-2" d="m-1999.97 386.233h-.06c-7.1765-.008-12.9923-5.8235-13-13-.018-7.19696 5.803-13.04511 13-13.06 7.197-.0183 13.0451 5.80303 13.06 13 .018 7.19696-5.803 13.04511-13 13.06z" class="cls-1" data-name="Path 1619" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1620-5-3-5" d="m-1999.97 422.323h-.06c-7.1765-.008-12.9923-5.8235-13-13-.018-7.19696 5.803-13.04511 13-13.06 7.197-.0182 13.0451 5.80303 13.06 13 .018 7.19696-5.803 13.04511-13 13.06z" class="cls-1" data-name="Path 1620" inkscape:connector-curvature="0" style="fill:#fff"/><path sodipodi:nodetypes="cccccc" id="Path_1621-0-7-4" d="m-1963.88 386.233h-.06c-7.1763-.008-12.9917-5.82372-13-13-.018-7.19673 5.8033-13.04455 13-13.06 7.197-.0183 13.0451 5.80303 13.06 13 .018 7.19696-5.803 13.04511-13 13.06z" class="cls-1" data-name="Path 1621" inkscape:connector-curvature="0" style="fill:#fff"/></g></g></g></g></svg></span><span class="navbar-brand__name">Bank-Vaults</span>
<span class="font-weight-bold navbar-logo navbar-version">1.19.0</span></a>
<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
<ul class="navbar-nav mt-2 mt-lg-0">
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link" href="https://github.com/banzaicloud/bank-vaults" target="_blank"><span>Project page</span></a>
</li><li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link" href="/docs/"><span>Documentation</span></a>
</li></ul></div><div class="navbar-nav d-none d-lg-block">
<div class="td-search td-search--offline">
<div class="td-search__icon"></div><input type="search" class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete="off" data-offline-search-index-json-src="/offline-search-index.38c7a8b02048636206bb76469273850a.json" data-offline-search-base-href="/" data-offline-search-max-results="10">
</div></div></nav></header><div class="container-fluid td-outer">
<div class="td-main">
<div class="row flex-xl-nowrap">
<aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
<div id="td-sidebar-menu" class="td-sidebar__inner">
<form class="td-sidebar__search d-flex align-items-center">
<div class="td-search td-search--offline">
<div class="td-search__icon"></div><input type="search" class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete="off" data-offline-search-index-json-src="/offline-search-index.38c7a8b02048636206bb76469273850a.json" data-offline-search-base-href="/" data-offline-search-max-results="10">
</div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-section-nav" aria-expanded="false" aria-label="Toggle section navigation">
</button>
</form><nav class="collapse td-sidebar-nav foldable-nav" id="td-section-nav">
<ul class="td-sidebar-nav__section pr-md-3 ul-0">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-docs-li">
<a href="/docs/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-docs"><span>Documentation</span></a>
<ul class="ul-1">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsinstalling-li">
<input type="checkbox" id="m-docsinstalling-check">
<label for="m-docsinstalling-check"><a href="/docs/installing/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsinstalling"><span>Getting started</span></a></label>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsinstallingcustom-namespace-li">
<input type="checkbox" id="m-docsinstallingcustom-namespace-check">
<label for="m-docsinstallingcustom-namespace-check"><a href="/docs/installing/custom-namespace/" title="Deploy vault into a custom namespace" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsinstallingcustom-namespace"><span>Custom namespace</span></a></label>
</li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsexternal-configuration-li">
<input type="checkbox" id="m-docsexternal-configuration-check">
<label for="m-docsexternal-configuration-check"><a href="/docs/external-configuration/" title="External configuration for Vault" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsexternal-configuration"><span>External Vault configuration</span></a></label>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsexternal-configurationpurge-unmanaged-configuration-li">
<input type="checkbox" id="m-docsexternal-configurationpurge-unmanaged-configuration-check">
<label for="m-docsexternal-configurationpurge-unmanaged-configuration-check"><a href="/docs/external-configuration/purge-unmanaged-configuration/" title="Fully or partially purging unmanaged configuration in Vault" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsexternal-configurationpurge-unmanaged-configuration"><span>Purge unmanaged configuration</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsexternal-configurationaudit-devices-li">
<input type="checkbox" id="m-docsexternal-configurationaudit-devices-check">
<label for="m-docsexternal-configurationaudit-devices-check"><a href="/docs/external-configuration/audit-devices/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsexternal-configurationaudit-devices"><span>Audit devices</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsexternal-configurationauthentication-li">
<input type="checkbox" id="m-docsexternal-configurationauthentication-check">
<label for="m-docsexternal-configurationauthentication-check"><a href="/docs/external-configuration/authentication/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsexternal-configurationauthentication"><span>Authentication</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsexternal-configurationplugins-li">
<input type="checkbox" id="m-docsexternal-configurationplugins-check">
<label for="m-docsexternal-configurationplugins-check"><a href="/docs/external-configuration/plugins/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsexternal-configurationplugins"><span>Plugins</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsexternal-configurationpolicies-li">
<input type="checkbox" id="m-docsexternal-configurationpolicies-check">
<label for="m-docsexternal-configurationpolicies-check"><a href="/docs/external-configuration/policies/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsexternal-configurationpolicies"><span>Policies</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsexternal-configurationsecrets-engines-li">
<input type="checkbox" id="m-docsexternal-configurationsecrets-engines-check">
<label for="m-docsexternal-configurationsecrets-engines-check"><a href="/docs/external-configuration/secrets-engines/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsexternal-configurationsecrets-engines"><span>Secrets engines</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsexternal-configurationstartup-secrets-li">
<input type="checkbox" id="m-docsexternal-configurationstartup-secrets-check">
<label for="m-docsexternal-configurationstartup-secrets-check"><a href="/docs/external-configuration/startup-secrets/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsexternal-configurationstartup-secrets"><span>Startup secrets</span></a></label>
</li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsenvironment-variables-li">
<input type="checkbox" id="m-docsenvironment-variables-check">
<label for="m-docsenvironment-variables-check"><a href="/docs/environment-variables/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsenvironment-variables"><span>Environment variables</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsoperator-li">
<input type="checkbox" id="m-docsoperator-check">
<label for="m-docsoperator-check"><a href="/docs/operator/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsoperator"><span>Operator</span></a></label>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsoperatorhowto-vault-e2e-li">
<input type="checkbox" id="m-docsoperatorhowto-vault-e2e-check">
<label for="m-docsoperatorhowto-vault-e2e-check"><a href="/docs/operator/howto-vault-e2e/" title="Running Vault with external end to end encryption" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsoperatorhowto-vault-e2e"><span>External encryption</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsoperatortemplating-configuration-li">
<input type="checkbox" id="m-docsoperatortemplating-configuration-check">
<label for="m-docsoperatortemplating-configuration-check"><a href="/docs/operator/templating-configuration/" title="Using templates for injecting dynamic configuration" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsoperatortemplating-configuration"><span>Templating configuration</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsoperatorupgrade-vault-li">
<input type="checkbox" id="m-docsoperatorupgrade-vault-check">
<label for="m-docsoperatorupgrade-vault-check"><a href="/docs/operator/upgrade-vault/" title="Upgrade Vault with the Bank-Vaults operator" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsoperatorupgrade-vault"><span>Upgrade Vault</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsoperatorcr_example_and_explanation-li">
<input type="checkbox" id="m-docsoperatorcr_example_and_explanation-check">
<label for="m-docsoperatorcr_example_and_explanation-check"><a href="/docs/operator/cr_example_and_explanation/" title="Operator Configuration for Functioning Webhook Secrets Mutation" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsoperatorcr_example_and_explanation"><span>Operator and mutating webhook</span></a></label>
</li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-docsmutating-webhook-li">
<input type="checkbox" id="m-docsmutating-webhook-check" checked>
<label for="m-docsmutating-webhook-check"><a href="/docs/mutating-webhook/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsmutating-webhook"><span>Mutating Webhook</span></a></label>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmutating-webhookdeploy-li">
<input type="checkbox" id="m-docsmutating-webhookdeploy-check">
<label for="m-docsmutating-webhookdeploy-check"><a href="/docs/mutating-webhook/deploy/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsmutating-webhookdeploy"><span>Deploy the webhook</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id="m-docsmutating-webhookconfiguration-li">
<input type="checkbox" id="m-docsmutating-webhookconfiguration-check" checked>
<label for="m-docsmutating-webhookconfiguration-check"><a href="/docs/mutating-webhook/configuration/" title="Configuration examples and scenarios" class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id="m-docsmutating-webhookconfiguration"><span class="td-sidebar-nav-active-item">Configure the webhook</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmutating-webhookannotations-li">
<input type="checkbox" id="m-docsmutating-webhookannotations-check">
<label for="m-docsmutating-webhookannotations-check"><a href="/docs/mutating-webhook/annotations/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsmutating-webhookannotations"><span>Annotations</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmutating-webhookvault-agent-templating-li">
<input type="checkbox" id="m-docsmutating-webhookvault-agent-templating-check">
<label for="m-docsmutating-webhookvault-agent-templating-check"><a href="/docs/mutating-webhook/vault-agent-templating/" title="Using Vault Agent Templating in the mutating webhook" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsmutating-webhookvault-agent-templating"><span>Vault Agent Templating</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmutating-webhookconsul-template-li">
<input type="checkbox" id="m-docsmutating-webhookconsul-template-check">
<label for="m-docsmutating-webhookconsul-template-check"><a href="/docs/mutating-webhook/consul-template/" title="Using consul-template in the mutating webhook" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsmutating-webhookconsul-template"><span>Consul template</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmutating-webhooktransit-encryption-li">
<input type="checkbox" id="m-docsmutating-webhooktransit-encryption-check">
<label for="m-docsmutating-webhooktransit-encryption-check"><a href="/docs/mutating-webhook/transit-encryption/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsmutating-webhooktransit-encryption"><span>Transit Encryption</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmutating-webhookmonitoring-li">
<input type="checkbox" id="m-docsmutating-webhookmonitoring-check">
<label for="m-docsmutating-webhookmonitoring-check"><a href="/docs/mutating-webhook/monitoring/" title="Monitoring the Webhook with Grafana and Prometheus" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsmutating-webhookmonitoring"><span>Monitoring</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmutating-webhookhowto-ct-prom-li">
<input type="checkbox" id="m-docsmutating-webhookhowto-ct-prom-check">
<label for="m-docsmutating-webhookhowto-ct-prom-check"><a href="/docs/mutating-webhook/howto-ct-prom/" title="Injecting consul-template into the Prometheus operator for Vault metrics" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsmutating-webhookhowto-ct-prom"><span>Injecting secrets into Prometheus</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmutating-webhookwebhooks-comparision-li">
<input type="checkbox" id="m-docsmutating-webhookwebhooks-comparision-check">
<label for="m-docsmutating-webhookwebhooks-comparision-check"><a href="/docs/mutating-webhook/webhooks-comparision/" title="Comparison of Banzai Cloud and HashiCorp mutating webhook for Vault" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsmutating-webhookwebhooks-comparision"><span>Comparison</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmutating-webhookexternal-vault-li">
<input type="checkbox" id="m-docsmutating-webhookexternal-vault-check">
<label for="m-docsmutating-webhookexternal-vault-check"><a href="/docs/mutating-webhook/external-vault/" title="Running the webhook and Vault on different clusters" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsmutating-webhookexternal-vault"><span>External Vault</span></a></label>
</li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsunseal-keys-li">
<input type="checkbox" id="m-docsunseal-keys-check">
<label for="m-docsunseal-keys-check"><a href="/docs/unseal-keys/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsunseal-keys"><span>Unseal keys</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docstls-li">
<input type="checkbox" id="m-docstls-check">
<label for="m-docstls-check"><a href="/docs/tls/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docstls"><span>TLS</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docscloud-permissions-li">
<input type="checkbox" id="m-docscloud-permissions-check">
<label for="m-docscloud-permissions-check"><a href="/docs/cloud-permissions/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docscloud-permissions"><span>Cloud permissions</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsbackup-li">
<input type="checkbox" id="m-docsbackup-check">
<label for="m-docsbackup-check"><a href="/docs/backup/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsbackup"><span>Backing up Vault</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsistio-li">
<input type="checkbox" id="m-docsistio-check">
<label for="m-docsistio-check"><a href="/docs/istio/" title="Running the Bank-Vaults secret webhook alongside Istio" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsistio"><span>Istio and Bank-Vaults</span></a></label>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsistiovault-outside-the-mesh-li">
<input type="checkbox" id="m-docsistiovault-outside-the-mesh-check">
<label for="m-docsistiovault-outside-the-mesh-check"><a href="/docs/istio/vault-outside-the-mesh/" title="Scenario 1 - Vault runs outside, the application inside the mesh" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsistiovault-outside-the-mesh"><span>Vault outside the mesh</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsistiovault-inside-the-mesh-li">
<input type="checkbox" id="m-docsistiovault-inside-the-mesh-check">
<label for="m-docsistiovault-inside-the-mesh-check"><a href="/docs/istio/vault-inside-the-mesh/" title="Scenario 2 - Running Vault inside the mesh" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsistiovault-inside-the-mesh"><span>Vault inside the mesh</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsistiovault-and-app-inside-the-mesh-li">
<input type="checkbox" id="m-docsistiovault-and-app-inside-the-mesh-check">
<label for="m-docsistiovault-and-app-inside-the-mesh-check"><a href="/docs/istio/vault-and-app-inside-the-mesh/" title="Scenario 3 - Both Vault and the app are running inside the mesh" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsistiovault-and-app-inside-the-mesh"><span>Vault and app inside the mesh</span></a></label>
</li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docshsm-li">
<input type="checkbox" id="m-docshsm-check">
<label for="m-docshsm-check"><a href="/docs/hsm/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docshsm"><span>HSM Support</span></a></label>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docshsmnitrokey-opensc-li">
<input type="checkbox" id="m-docshsmnitrokey-opensc-check">
<label for="m-docshsmnitrokey-opensc-check"><a href="/docs/hsm/nitrokey-opensc/" title="NitroKey HSM support (OpenSC)" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docshsmnitrokey-opensc"><span>Nitrokey</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docshsmsofthsm-li">
<input type="checkbox" id="m-docshsmsofthsm-check">
<label for="m-docshsmsofthsm-check"><a href="/docs/hsm/softhsm/" title="SoftHSM support for testing" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docshsmsofthsm"><span>SoftHSM</span></a></label>
</li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docscli-tool-li">
<input type="checkbox" id="m-docscli-tool-check">
<label for="m-docscli-tool-check"><a href="/docs/cli-tool/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docscli-tool"><span>The CLI tool</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsgo-library-li">
<input type="checkbox" id="m-docsgo-library-check">
<label for="m-docsgo-library-check"><a href="/docs/go-library/" title="The Go library" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsgo-library"><span>Go library</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmonitoring-li">
<input type="checkbox" id="m-docsmonitoring-check">
<label for="m-docsmonitoring-check"><a href="/docs/monitoring/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsmonitoring"><span>Monitoring</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsannotations-and-labels-li">
<input type="checkbox" id="m-docsannotations-and-labels-check">
<label for="m-docsannotations-and-labels-check"><a href="/docs/annotations-and-labels/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsannotations-and-labels"><span>Annotations and labels</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsexternal-secrets-li">
<input type="checkbox" id="m-docsexternal-secrets-check">
<label for="m-docsexternal-secrets-check"><a href="/docs/external-secrets/" title="Watching External Secrets" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsexternal-secrets"><span>External Secrets</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docstips-and-tricks-li">
<input type="checkbox" id="m-docstips-and-tricks-check">
<label for="m-docstips-and-tricks-check"><a href="/docs/tips-and-tricks/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docstips-and-tricks"><span>Tips and tricks</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docssupport-li">
<input type="checkbox" id="m-docssupport-check">
<label for="m-docssupport-check"><a href="/docs/support/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docssupport"><span>Support</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdevelopment-li">
<input type="checkbox" id="m-docsdevelopment-check">
<label for="m-docsdevelopment-check"><a href="/docs/development/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsdevelopment"><span>Development</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docscontributing-li">
<input type="checkbox" id="m-docscontributing-check">
<label for="m-docscontributing-check"><a href="/docs/contributing/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docscontributing"><span>Contributing</span></a></label>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsmaintainer-li">
<input type="checkbox" id="m-docsmaintainer-check">
<label for="m-docsmaintainer-check"><a href="/docs/maintainer/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsmaintainer"><span>Maintainer guide</span></a></label>
</li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
<a href="https://github.com/bank-vaults/bank-vaults.dev/tree/main/content/docs/mutating-webhook/configuration.md" class="td-page-meta--view" target="_blank" rel="noopener"><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href="https://github.com/bank-vaults/bank-vaults.dev/edit/main/content/docs/mutating-webhook/configuration.md" class="td-page-meta--edit" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/bank-vaults/bank-vaults.dev/new/main/content/docs/mutating-webhook/configuration.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/bank-vaults/bank-vaults.dev/issues/new?title=Configuration%20examples%20and%20scenarios" class="td-page-meta--issue" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
<a href="https://github.com/banzaicloud/bank-vaults/issues/new" class="td-page-meta--project-issue" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create project issue</a>
<a id="print" href="https://bank-vaults.dev/docs/mutating-webhook/_print/"><i class="fa-solid fa-print fa-fw"></i> Print entire section</a>
</div><div class="td-toc">
<nav id="TableOfContents">
<ul>
<li><a href="#prerequisites-for-inline-injection-to-work">Prerequisites for inline injection to work</a></li><li><a href="#inject-secret-into-resources">Inject secret into resources</a></li><li><a href="#inline">Inline mutation</a></li><li><a href="#define-multiple-inline-secrets-in-resources">Define multiple inline-secrets in resources</a></li><li><a href="#request-a-vault-token">Request a Vault token</a></li><li><a href="#read-a-value-from-vault">Read a value from Vault</a></li><li><a href="#write-a-value-into-vault">Write a value into Vault</a></li><li><a href="#templating-in-values">Templating in values</a></li><li><a href="#mutate-data-from-vault-and-replace-it-in-kubernetes-secret">Mutate data from Vault and replace it in Kubernetes Secret</a></li><li><a href="#use-charts-without-explicit-containercommand-and-containerargs">Use charts without explicit container.command and container.args</a></li><li><a href="#registry-access">Registry access</a>
<ul>
<li><a href="#using-a-private-image-repository">Using a private image repository</a></li></ul></li><li><a href="#mount-all-keys-from-vault-secret-to-env">Mount all keys from Vault secret to env</a></li><li><a href="#webhook-auth">Authenticate the webhook to Vault</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
<nav aria-label="breadcrumb" class="td-breadcrumbs">
<ol class="breadcrumb">
<li class="breadcrumb-item">
<a href="https://bank-vaults.dev/docs/">Documentation</a>
</li><li class="breadcrumb-item">
<a href="https://bank-vaults.dev/docs/mutating-webhook/">Mutating Webhook</a>
</li><li class="breadcrumb-item active" aria-current="page">
<a href="https://bank-vaults.dev/docs/mutating-webhook/configuration/" aria-disabled="true" class="btn-link disabled">Configure the webhook</a>
</li></ol></nav><div class="td-content">
<h1>Configuration examples and scenarios</h1><header class="article-meta">
</header><p>The following examples show you how to configure the mutating webhook to best suit your environment.</p><p>The webhook checks if a container has environment variables defined in the following formats, and reads the values for those variables directly from Vault during startup time.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">env</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">AWS_SECRET_ACCESS_KEY</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:700">value</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">vault:secret/data/accounts/aws#AWS_SECRET_ACCESS_KEY</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># or</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">AWS_SECRET_ACCESS_KEY</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:700">valueFrom</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:700">secretKeyRef</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aws-key-secret</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:700">key</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">AWS_SECRET_ACCESS_KEY</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># or</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">AWS_SECRET_ACCESS_KEY</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:700">valueFrom</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:700">configMapKeyRef</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aws-key-configmap</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:700">key</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">AWS_SECRET_ACCESS_KEY</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The webhook checks if a container has <em>envFrom</em> and parses the defined ConfigMaps and Secrets:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">envFrom</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:700">secretRef</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aws-key-secret</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># or</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:700">configMapRef</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aws-key-configmap</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="secret-and-configmap-examples">Secret and ConfigMap examples</h2><p>Secrets require their payload to be base64 encoded, the API rejects manifests with plaintext in them.
The secret value should contain a base64 encoded template string referencing the vault path you want to insert.
Run <code>echo -n "vault:secret/data/accounts/aws#AWS_SECRET_ACCESS_KEY" | base64</code> to get the correct string.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">apiVersion</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">kind</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Secret</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">metadata</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aws-key-secret</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">data</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">AWS_SECRET_ACCESS_KEY</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">dmF1bHQ6c2VjcmV0L2RhdGEvYWNjb3VudHMvYXdzI0FXU19TRUNSRVRfQUNDRVNTX0tFWQ==</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">type</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Opaque</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">apiVersion</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">kind</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ConfigMap</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">metadata</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aws-key-configmap</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">data</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">AWS_SECRET_ACCESSKEY</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">vault:secret/data/accounts/aws#AWS_SECRET_ACCESS_KEY</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="prerequisites-for-inline-injection-to-work">Prerequisites for inline injection to work</h2><p>Vault needs to be properly configured for mutation to function; namely
<code>externalConfig.auth</code> and <code>externConfig.roles</code> (from the perspective of the
vault operator CR) need to be properly configured. If you&rsquo;re not using the vault
operator then you must make sure that your Vault configuration for <code>Kubernetes</code>
auth methods <a href="https://developer.hashicorp.com/vault/docs/auth/kubernetes">are properly configured</a>. This configuration is outside the scope
of this document. If you use the operator for managing Vault in your cluster, see the <a href="/docs/operator/">Vault operator documentation</a>.</p><h2 id="inject-secret-into-resources">Inject secret into resources</h2><p>The webhook can inject into any kind of resources, even into CRDs, for example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">apiVersion</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">mysql.example.github.com/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">kind</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">MySQLCluster</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">metadata</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;my-cluster&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">spec</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">caBundle</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;vault:pki/cert/43138323834372136778363829719919055910246657114#ca&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="inline">Inline mutation</h2><p>The webhook also supports inline mutation when your secret needs to be replaced somewhere inside a string.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">apiVersion</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">kind</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Secret</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">metadata</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aws-key-secret</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">data</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">config.yaml</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">foo</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">bar</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">secret</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${vault:secret/data/mysecret#supersecret}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">type</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Opaque</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>This works also for ConfigMap resources when <code>configMapMutation: true</code> is set in the webhook&rsquo;s Helm chart.</p><p>You can specify the version of the injected Vault secret as well in the special reference, the format is: <code>vault:PATH#KEY_OR_TEMPLATE#VERSION</code></p><p>Example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">env</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">AWS_SECRET_ACCESS_KEY</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:700">value</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">vault:secret/data/accounts/aws#AWS_SECRET_ACCESS_KEY#2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="define-multiple-inline-secrets-in-resources">Define multiple inline-secrets in resources</h2><p>You can also inject multiple secrets under the same key in a Secret/ConfigMap/Object. This means that you can use multiple Vault paths in a value, for example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">apiVersion</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">kind</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ConfigMap</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">metadata</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sample-configmap</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">annotations</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">vault.security.banzaicloud.io/vault-addr</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;https://vault.default:8200&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">vault.security.banzaicloud.io/vault-role</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">vault.security.banzaicloud.io/vault-tls-secret</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">vault-tls</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">vault.security.banzaicloud.io/vault-path</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;kubernetes&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">data</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">aws-access-key-id</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;vault:secret/data/accounts/aws#AWS_ACCESS_KEY_ID&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">aws-access-template</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;vault:secret/data/accounts/aws#AWS key in base64: ${.AWS_ACCESS_KEY_ID | b64enc}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">aws-access-inline</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;AWS_ACCESS_KEY_ID: ${vault:secret/data/accounts/aws#AWS_ACCESS_KEY_ID} AWS_SECRET_ACCESS_KEY: ${vault:secret/data/accounts/aws#AWS_SECRET_ACCESS_KEY}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>This example also shows how a CA certificate (created by the operator) can be used with the <code>vault.security.banzaicloud.io/vault-tls-secret: vault-tls</code> annotation to validate the TLS connection in case of a non-Pod resource.</p><h2 id="request-a-vault-token">Request a Vault token</h2><p>There is a special <code>vault:login</code> reference format to request a working Vault token into an environment variable to be later consumed by your application:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">env</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">VAULT_TOKEN</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:700">value</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">vault:login</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="read-a-value-from-vault">Read a value from Vault</h2><p>Values starting with <code>"vault:"</code> issue a <code>read</code> (HTTP GET) request towards the Vault API, this can be also used to request a <a href="https://developer.hashicorp.com/vault/docs/secrets/databases/mysql-maria#usage">dynamic database username/password pair for MySQL</a>:</p><p><em><strong>NOTE</strong>: This feature takes advantage of secret caching since we need to access the <code>my-role</code> endpoint twice, but in the background, it is written only once in Vault:</em></p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">env</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">MYSQL_USERNAME</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">value</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;vault:database/creds/my-role#username&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">MYSQL_PASSWORD</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">value</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;vault:database/creds/my-role#password&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">REDIS_URI</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">value</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;redis://${vault:database/creds/my-role#username}:${vault:database/creds/my-role#password}@127.0.0.1:6739&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="write-a-value-into-vault">Write a value into Vault</h2><p>Values starting with <code>">>vault:"</code> issue a <code>write</code> (HTTP POST/PUT) request towards the Vault API, some secret engine APIs should be <code>written</code> instead of <code>reading from</code> like the <a href="https://github.com/sethvargo/vault-secrets-gen">Password Generator for HashiCorp Vault</a>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">env</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">MY_SECRET_PASSWORD</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">value</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&gt;&gt;vault:gen/password#value&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Or with <a href="https://developer.hashicorp.com/vault/api-docs/secret/transit#decrypt-data">Transit Secret Engine</a> which is a fairly complex example since we are using templates when rendering the response and send data in the write request as well, the format is: <code>vault:PATH#KEY_OR_TEMPLATE#DATA</code></p><p>Example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">env</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">MY_SECRET_PASSWORD</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">value</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&gt;&gt;vault:transit/decrypt/mykey#${.plaintext | b64dec}#{&#34;</span><span style="color:#000">ciphertext&#34;:&#34;vault:v1:/DupSiSbX/ATkGmKAmhqD0tvukByrx6gmps7dVI=&#34;}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="templating-in-values">Templating in values</h2><p><a href="https://golang.org/pkg/text/template/">Templating</a> is also supported on the secret sourced from Vault (in the key part, after the first <code>#</code>), in the very same fashion as in the Vault configuration and external configuration with all <a href="http://masterminds.github.io/sprig/">the Sprig functions</a> (this is supported only for Pods right now):</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">env</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DOCKER_USERNAME</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">value</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;vault:secret/data/accounts/dockerhub#My username on DockerHub is: ${title .DOCKER_USERNAME}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>In this case, an init-container will be injected into the given Pod. This container copies the <code>vault-env</code> binary into an in-memory volume and mounts that Volume to every container which has an environment variable definition like that. It also changes the <code>command</code> of the container to run <code>vault-env</code> instead of your application directly. When <code>vault-env</code> starts up, it connects to Vault to checks the environment variables. (By default, <code>vault-env</code> uses the <a href="https://developer.hashicorp.com/vault/docs/auth/kubernetes.html">Kubernetes Auth method</a>, but you can also <a href="#webhook-auth">configure other authentication methods for the webhook</a>.) The variables that have a reference to a value stored in Vault (<code>vault:secret/....</code>) are replaced with that value read from the Secret backend. After this, <code>vault-env</code> immediately executes (with <code>syscall.Exec()</code>) your process with the given arguments, replacing itself with that process (in non-daemon mode).</p><p><strong>With this solution none of your Secrets stored in Vault will ever land in Kubernetes Secrets, thus in etcd.</strong></p><p><code>vault-env</code> was designed to work in Kubernetes in the first place, but nothing stops you to use it outside Kubernetes as well. It can be configured with the standard Vault client&rsquo;s <a href="https://developer.hashicorp.com/vault/docs/commands#environment-variables">environment variables</a> (because there is a standard Go Vault client underneath).</p><p>Currently, the Kubernetes Service Account-based Vault authentication mechanism is used by <code>vault-env</code>, so it requests a Vault token based on the Service Account of the container it is injected into.</p><ul>
<li><a href="https://developer.hashicorp.com/vault/docs/auth/gcp">GCP</a> and general <a href="https://developer.hashicorp.com/vault/docs/auth/jwt">OIDC/JWT</a> authentication methods are supported as well, see the <a href="https://github.com/bank-vaults/vault-operator/blob/main/test/deploy/test-deployment-gcp.yaml">example manifest</a>.</li><li>Kubernetes <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#service-account-token-volume-projection">Projected Service Account Tokens</a> work too, as shown in <a href="https://github.com/bank-vaults/vault-operator/tree/main/test/oidc-pod.yaml">this example</a>.</li></ul><p>Kubernetes 1.12 introduced a feature called <a href="https://kubernetes.io/blog/2019/01/14/apiserver-dry-run-and-kubectl-diff/">APIServer dry-run</a> which became beta as of 1.13. This feature requires some changes in webhooks with side effects. Vault mutating admission webhook is <code>dry-run aware</code>.</p><h2 id="mutate-data-from-vault-and-replace-it-in-kubernetes-secret">Mutate data from Vault and replace it in Kubernetes Secret</h2><p>You can mutate Secrets (and ConfigMaps) as well if you set annotations and define proper Vault path in the <code>data</code> section:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">apiVersion</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">kind</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Secret</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">metadata</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sample-secret</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">annotations</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">vault.security.banzaicloud.io/vault-addr</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;https://vault.default.svc.cluster.local:8200&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">vault.security.banzaicloud.io/vault-role</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">vault.security.banzaicloud.io/vault-skip-verify</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;true&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">vault.security.banzaicloud.io/vault-path</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;kubernetes&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">type</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kubernetes.io/dockerconfigjson</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">data</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">.dockerconfigjson</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">eyJhdXRocyI6eyJodHRwczovL2RvY2tlci5pbyI6eyJ1c2VybmFtZSI6InZhdWx0OnNlY3JldC9kYXRhL2RvY2tlcnJlcG8vI0RPQ0tFUl9SRVBPX1VTRVIiLCJwYXNzd29yZCI6InZhdWx0OnNlY3JldC9kYXRhL2RvY2tlcnJlcG8vI0RPQ0tFUl9SRVBPX1BBU1NXT1JEIiwiYXV0aCI6ImRtRjFiSFE2YzJWamNtVjBMMlJoZEdFdlpHOWphMlZ5Y21Wd2J5OGpSRTlEUzBWU1gxSkZVRTlmVlZORlVqcDJZWFZzZERwelpXTnlaWFF2WkdGMFlTOWtiMk5yWlhKeVpYQnZMeU5FVDBOTFJWSmZVa1ZRVDE5UVFWTlRWMDlTUkE9PSJ9fX0=</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>In the example above the secret type is <code>kubernetes.io/dockerconfigjson</code> and the webhook can get credentials from Vault.
The base64 encoded data contain vault path in case of username and password for docker repository and you can create it with commands:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl create secret docker-registry dockerhub --docker-username<span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;vault:secret/data/dockerrepo#DOCKER_REPO_USER&#34;</span> --docker-password<span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;vault:secret/data/dockerrepo#DOCKER_REPO_PASSWORD&#34;</span>
</span></span><span style="display:flex"><span>kubectl annotate secret dockerhub vault.security.banzaicloud.io/vault-addr<span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;https://vault.default.svc.cluster.local:8200&#34;</span>
</span></span><span style="display:flex"><span>kubectl annotate secret dockerhub vault.security.banzaicloud.io/vault-role<span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;default&#34;</span>
</span></span><span style="display:flex"><span>kubectl annotate secret dockerhub vault.security.banzaicloud.io/vault-skip-verify<span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;true&#34;</span>
</span></span><span style="display:flex"><span>kubectl annotate secret dockerhub vault.security.banzaicloud.io/vault-path<span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;kubernetes&#34;</span>
</span></span></code></pre></div><h2 id="use-charts-without-explicit-containercommand-and-containerargs">Use charts without explicit container.command and container.args</h2><p>The Webhook can determine the container&rsquo;s <code>ENTRYPOINT</code> and <code>CMD</code> with the help of image metadata queried from the image registry. This data is cached until the webhook Pod is restarted. If the registry is publicly accessible (without authentication) you don&rsquo;t need to do anything, but if the registry requires authentication the credentials have to be available in the Pod&rsquo;s <code>imagePullSecrets</code> section.</p><p>Some examples (apply <code>cr.yaml</code> from the operator samples first):</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>helm upgrade --install mysql stable/mysql <span style="color:#4e9a06">\
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06"></span>  --set <span style="color:#000">mysqlRootPassword</span><span style="color:#ce5c00;font-weight:700">=</span>vault:secret/data/mysql#MYSQL_ROOT_PASSWORD <span style="color:#4e9a06">\
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06"></span>  --set <span style="color:#000">mysqlPassword</span><span style="color:#ce5c00;font-weight:700">=</span>vault:secret/data/mysql#MYSQL_PASSWORD <span style="color:#4e9a06">\
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06"></span>  --set <span style="color:#4e9a06">&#34;podAnnotations.vault\.security\.banzaicloud\.io/vault-addr&#34;</span><span style="color:#ce5c00;font-weight:700">=</span>https://vault:8200 <span style="color:#4e9a06">\
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06"></span>  --set <span style="color:#4e9a06">&#34;podAnnotations.vault\.security\.banzaicloud\.io/vault-tls-secret&#34;</span><span style="color:#ce5c00;font-weight:700">=</span>vault-tls
</span></span></code></pre></div><h2 id="registry-access">Registry access</h2><p>You can also specify a default secret being used by the webhook for cases where a pod has no <code>imagePullSecrets</code> specified. To make this work you have to set the environment variables <code>DEFAULT_IMAGE_PULL_SECRET</code> and <code>DEFAULT_IMAGE_PULL_SECRET_NAMESPACE</code> when deploying the vault-secrets-webhook. Have a look at the <a href="https://github.com/bank-vaults/vault-secrets-webhook/blob/main/deploy/charts/vault-secrets-webhook/values.yaml">values.yaml of the
vault-secrets-webhook</a> helm chart to see how this is done.</p><blockquote>
<p>Note:</p><ul>
<li>If your EC2 nodes have the ECR instance role, the webhook can request an ECR access token through that role automatically, instead of an explicit <code>imagePullSecret</code></li><li>If your workload is running on GCP nodes, the webhook automatically authenticates to GCR.</li></ul></blockquote><p>Future improvements:</p><ul>
<li>on Azure/Alibaba get a credential dynamically with the specific SDK (for AWS ECR and GCP GCR this is already done)</li></ul><h3 id="using-a-private-image-repository">Using a private image repository</h3><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span><span style="color:#8f5902;font-style:italic"># Docker Hub</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>kubectl create secret docker-registry dockerhub --docker-username<span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_USERNAME</span><span style="color:#4e9a06">}</span> --docker-password<span style="color:#ce5c00;font-weight:700">=</span><span style="color:#000">$DOCKER_PASSWORD</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>helm upgrade --install mysql stable/mysql --set <span style="color:#000">mysqlRootPassword</span><span style="color:#ce5c00;font-weight:700">=</span>vault:secret/data/mysql#MYSQL_ROOT_PASSWORD --set <span style="color:#4e9a06">&#34;imagePullSecrets[0].name=dockerhub&#34;</span> --set-string <span style="color:#4e9a06">&#34;podAnnotations.vault\.security\.banzaicloud\.io/vault-skip-verify=true&#34;</span> --set <span style="color:#000">image</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;private-repo/mysql&#34;</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#8f5902;font-style:italic"># GCR</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>kubectl create secret docker-registry gcr <span style="color:#4e9a06">\
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06"></span>--docker-server<span style="color:#ce5c00;font-weight:700">=</span>gcr.io <span style="color:#4e9a06">\
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06"></span>--docker-username<span style="color:#ce5c00;font-weight:700">=</span>_json_key <span style="color:#4e9a06">\
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06"></span>--docker-password<span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:700">$(</span>cat ~/json-key-file.json<span style="color:#204a87;font-weight:700">)</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>helm upgrade --install mysql stable/mysql --set <span style="color:#000">mysqlRootPassword</span><span style="color:#ce5c00;font-weight:700">=</span>vault:secret/data/mysql#MYSQL_ROOT_PASSWORD --set <span style="color:#4e9a06">&#34;imagePullSecrets[0].name=gcr&#34;</span> --set-string <span style="color:#4e9a06">&#34;podAnnotations.vault\.security\.banzaicloud\.io/vault-skip-verify=true&#34;</span> --set <span style="color:#000">image</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;gcr.io/your-repo/mysql&#34;</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#8f5902;font-style:italic"># ECR</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#000">TOKEN</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">`</span>aws ecr --region<span style="color:#ce5c00;font-weight:700">=</span>eu-west-1 get-authorization-token --output text --query authorizationData<span style="color:#ce5c00;font-weight:700">[]</span>.authorizationToken <span style="color:#000;font-weight:700">|</span> base64 --decode <span style="color:#000;font-weight:700">|</span> cut -d: -f2<span style="color:#4e9a06">`</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>kubectl create secret docker-registry ecr <span style="color:#4e9a06">\
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06"></span> --docker-server<span style="color:#ce5c00;font-weight:700">=</span>https://171832738826.dkr.ecr.eu-west-1.amazonaws.com <span style="color:#4e9a06">\
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06"></span> --docker-username<span style="color:#ce5c00;font-weight:700">=</span>AWS <span style="color:#4e9a06">\
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06"></span> --docker-password<span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">TOKEN</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span> helm upgrade --install mysql stable/mysql --set <span style="color:#000">mysqlRootPassword</span><span style="color:#ce5c00;font-weight:700">=</span>vault:secret/data/mysql#MYSQL_ROOT_PASSWORD --set <span style="color:#4e9a06">&#34;imagePullSecrets[0].name=ecr&#34;</span> --set-string <span style="color:#4e9a06">&#34;podAnnotations.vault\.security\.banzaicloud\.io/vault-skip-verify=true&#34;</span> --set <span style="color:#000">image</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;171832738826.dkr.ecr.eu-west-1.amazonaws.com/mysql&#34;</span> --set-string <span style="color:#000">imageTag</span><span style="color:#ce5c00;font-weight:700">=</span>5.7
</span></span></code></pre></div><h2 id="mount-all-keys-from-vault-secret-to-env">Mount all keys from Vault secret to env</h2><p>This feature is very similar to Kubernetes&rsquo; standard <code>envFrom:</code> <a href="https://kubernetes.io/docs/concepts/configuration/secret/#use-case-as-container-environment-variables">construct</a>, but instead of a Kubernetes Secret/ConfigMap, all its keys are mounted from a Vault secret using the webhook and vault-env.</p><p>You can set the Vault secret to mount using the <code>vault.security.banzaicloud.io/vault-env-from-path</code> annotation.</p><p>Compared to the original environment variable definition in the Pod <code>env</code> construct, the only difference is that you won&rsquo;t see the actual environment variables in the definition, because they are dynamic, and are based on the contents of the Vault secret&rsquo;s, just like <code>envFrom:</code>.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">apiVersion</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">apps/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">kind</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Deployment</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">metadata</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">hello-secrets</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">spec</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">selector</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">matchLabels</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">app.kubernetes.io/name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">hello-secrets</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">template</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">metadata</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">labels</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">app.kubernetes.io/name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">hello-secrets</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">annotations</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">vault.security.banzaicloud.io/vault-addr</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;https://vault:8200&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">vault.security.banzaicloud.io/vault-tls-secret</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">vault-tls</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">vault.security.banzaicloud.io/vault-env-from-path</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;secret/data/accounts/aws&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">spec</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">initContainers</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">init-ubuntu</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">image</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ubuntu</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">command</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:700">[</span><span style="color:#4e9a06">&#34;sh&#34;</span><span style="color:#000;font-weight:700">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;-c&#34;</span><span style="color:#000;font-weight:700">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;echo AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID &amp;&amp; echo initContainers ready&#34;</span><span style="color:#000;font-weight:700">]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">containers</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">alpine</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">image</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">alpine</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">command</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:700">[</span><span style="color:#4e9a06">&#34;sh&#34;</span><span style="color:#000;font-weight:700">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;-c&#34;</span><span style="color:#000;font-weight:700">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;echo AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY &amp;&amp; echo going to sleep... &amp;&amp; sleep 10000&#34;</span><span style="color:#000;font-weight:700">]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="webhook-auth">Authenticate the webhook to Vault</h2><p>By default, the webhook uses Kubernetes <a href="https://developer.hashicorp.com/vault/docs/auth/kubernetes">ServiceAccount-based authentication</a> in Vault. Use the <code>vault.security.banzaicloud.io/vault-auth-method</code> annotation to request different authentication types from the following supported types: <strong>&ldquo;kubernetes&rdquo;, &ldquo;aws-ec2&rdquo;, &ldquo;gcp-gce&rdquo;, &ldquo;gcp-iam&rdquo;, &ldquo;jwt&rdquo;, &ldquo;azure&rdquo;</strong>.</p><blockquote>
<p>Note: GCP IAM authentication (<strong>gcp-iam</strong>) only allows for authentication with the &lsquo;default&rsquo; service account of the caller, and a new token is generated at every request.
Note: Azure MSI authentication (<strong>azure</strong>) a new token is generated at every request.</p></blockquote><p>The following deployment - if running on a GCP instance - will automatically receive a signed JWT token from the metadata server of the cloud provider, and use it to authenticate against Vault. The same goes for <code>vault-auth-method: "aws-ec2"</code>, when running on an EC2 node with the right instance-role.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">apiVersion</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">apps/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">kind</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Deployment</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">metadata</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">vault-env-gcp-auth</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">spec</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">selector</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">matchLabels</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">app.kubernetes.io/name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">vault-env-gcp-auth</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">template</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">metadata</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">labels</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">app.kubernetes.io/name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">vault-env-gcp-auth</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">annotations</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># These annotations enable Vault GCP GCE auth, see:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># https://developer.hashicorp.com/vault/docs/auth/gcp#gce-login</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">vault.security.banzaicloud.io/vault-addr</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;https://vault:8200&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">vault.security.banzaicloud.io/vault-tls-secret</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">vault-tls</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">vault.security.banzaicloud.io/vault-role</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;my-role&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">vault.security.banzaicloud.io/vault-path</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;gcp&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">vault.security.banzaicloud.io/vault-auth-method</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;gcp-gce&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">spec</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">containers</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">alpine</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:700">image</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">alpine</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:700">command</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#4e9a06">&#34;sh&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#4e9a06">&#34;-c&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#4e9a06">&#34;echo $MYSQL_PASSWORD &amp;&amp; echo going to sleep... &amp;&amp; sleep 10000&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:700">env</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">MYSQL_PASSWORD</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:700">value</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">vault:secret/data/mysql#MYSQL_PASSWORD</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><div class="text-muted mt-5 pt-3 border-top">
Last modified July 25, 2023: <a href="https://github.com/bank-vaults/bank-vaults.dev/commit/1021aa4fefa0160382fc3ca12d6e6b686cfe77ff">Merge 9a3982484d044b0d3de8f8eb531008482fea164a into 54c25690a306e341082608f7e7196546cc89a06e (1021aa4)</a>
</div></div></main></div></div><footer class="bg-dark py-5 row d-print-none">
<div class="container-fluid mx-sm-5">
<div class="row">
<div class="col-6 col-sm-4 text-xs-center order-sm-2">
</div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
<a class="text-white" target="_blank" rel="noopener" href="https://github.com/banzaicloud/bank-vaults" aria-label="GitHub">
<i class="fab fa-github"></i>
</a>
</li><li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
<a class="text-white" target="_blank" rel="noopener" href="https://eti.cisco.com/slack" aria-label="Slack">
<i class="fab fa-slack"></i>
</a>
</li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2">
<small class="text-white">&copy; 2023 Bank-Vaults maintainers All Rights Reserved</small>
</div></div></div></footer></div><script src="/js/main.min.2aff983e9d0d8ecff9ed53e14b657216e2d8d2aff059bf4a5651283020995f1b.js" integrity="sha256-Kv+YPp0Njs/57VPhS2VyFuLY0q/wWb9KVlEoMCCZXxs=" crossorigin="anonymous"></script>
<script src='/js/prism.js'></script>
<script src='/js/tabpane-persist.js'></script>
<script src="/js/tocbot.min.js"></script>
<script type="text/javascript">tocbot.init({tocSelector:".td-toc",contentSelector:".td-content",headingSelector:"h2, h3, h4",ignoreHiddenElements:!0})</script>
</body></html>